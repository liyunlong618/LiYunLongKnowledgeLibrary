___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 048 敌人Delay掉血的条

___________________________________________________________________________________________

## 处理关键点

1. 计时器的逻辑

2. 内部持有状态变量的思路

3. Tick优化(不用的技能记得关闭Tick)


___________________________________________________________________________________________

# 目录

- [GAS 048 敌人Delay掉血的条](#gas-048-敌人delay掉血的条)
  - [处理关键点](#处理关键点)
- [目录](#目录)
    - [这一节没有代码纯蓝图操作](#这一节没有代码纯蓝图操作)
    - [修改火球伤害](#修改火球伤害)
    - [UI *WBP\_ProgressBar* 中创建ProgressBar并配置参数和整合成函数](#ui-wbp_progressbar-中创建progressbar并配置参数和整合成函数)
    - [UI *WBP\_ProgressBar* 中创建Delay掉血的效果](#ui-wbp_progressbar-中创建delay掉血的效果)
      - [此时效果gif](#此时效果gif)
    - [做一个小效果:敌人如果2秒内没有受到伤害,就隐藏其血条,直到其血量发生变化时,再次显示](#做一个小效果敌人如果2秒内没有受到伤害就隐藏其血条直到其血量发生变化时再次显示)
    - [下面将进行一些优化](#下面将进行一些优化)
    - [优化后效果gif](#优化后效果gif)


___________________________________________________________________________________________

### 这一节没有代码纯蓝图操作

### 修改火球伤害

> 我火球伤害有点低效果不是很明显，修改一下伤害
>
> ![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/19.png?raw=true)

___________________________________________________________________________________________

### UI *WBP_ProgressBar* 中创建ProgressBar并配置参数和整合成函数

> 1. 创建 `ProgressBar` 设为变量，并改名 `ProgressBar_Ghost` 
> 2. 蓝图中，`SetStyle` 设置背景 `BackgroundImage` 的alpha为0，`FillImage`为变量，改名为 `GhostBarFillBrush` 放入之前创建的分组ProgressBarProperties中。
> 3. 设置 `GhostBarFillBrush` 的默认值为深一点的颜色
> 4. 调整`ProgressBar_Ghost` 的 `FillColorAndOpacity` 为白色，`Percent` 调1便于查看![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/1.png?raw=true)
> 5. 合并为函数，命名为 `UpdateGhostFillBrush` 在 `PreConstruct` 上调用

___________________________________________________________________________________________

### UI *WBP_ProgressBar* 中创建Delay掉血的效果

> 1. *WBP_ProgressBar* 中创建函数 `SetBarPercent` ![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/2.png?raw=true)
> 2. 替换这里的函数![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/3.png?raw=true)
> 3. 创建float变量 `GhostPercentTarget` 设置默认值为1 
> 4. 在Tick中使用线性插值 `FinterpTo` 做效果![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/4.png?raw=true)
> 5. 合并为函数，取名 `InterpGhostBar` 
> 6. 因为逻辑在父类的 `Tick` 函数中，所以 *WBP _EnemyHealthBar* 需要添加调用父函数
> 7. 下一步需要设置 `GhostPercentTarget` 创建自定义事件取名 `UpdateGhostinterpTarget` 形参为float取名 `Target` 
> 8. 在 *WBP_ProgressBar* 的 `SetBarPercent` 函数执行结尾调用 `UpdateGhostinterpTarget` 事件，传入计算后的百分比![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/5.png?raw=true)
> 9. 在 `UpdateGhostinterpTarget` 中Delay一段时间后，Set `GhostPercentTarget` 的值![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/6.png?raw=true)
>
> **这时每次设置血条百分比就会将数值传入 `UpdateGhostinterpTarget` 事件设置 `GhostPercentTarget` ，然后在Tick中触发线性插值 `FinterpTo` 达成效果**

#### 此时效果gif

![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/7.gif)

___________________________________________________________________________________________

### 做一个小效果:敌人如果2秒内没有受到伤害,就隐藏其血条,直到其血量发生变化时,再次显示

> 思路：每次我们调用函数设置bar百分比时，我们可以设置显示血条UI并开始计时器，每次设置百分比时，我们可以重置该计时器
>
> 计时器触发函数命名为 `HideProgressBar` 
>
> ![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/8.png?raw=true)
>
> 别忘了在一开始隐藏血条
>
> ![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/9.png?raw=true)
>
> 确保子类调用父类逻辑
>
> <img src="https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/20.png" style="zoom: 50%;" />

此时gif

![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/10.gif)



___________________________________________________________________________________________

### 下面将进行一些优化

1. 优化Visibility创建函数 `SetBarVisibility` 设置Visibility

2. 内部持有bool可以查询血条开启状态，创建bool变量起名 `ProgressBarvisible` 

3. 优化Tick逻辑，`ProgressBarvisible` 限制，`ProgressBarvisible == true`时才开启，使用避免不用时的开销

![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/11.png?raw=true)

![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/12.png?raw=true)

### 优化后效果gif

![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_048/18.gif)

> **我这里2秒没收到伤害就关闭血条UI显示，有点短，建议长一些比如6秒，8秒这样**

___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________