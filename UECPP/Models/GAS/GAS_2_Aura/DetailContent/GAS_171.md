___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 171 使用Timer为闪电链制作掉血逻辑，并在首个目标死亡后结束技能

___________________________________________________________________________________________

## 处理关键点

1. 使用计时器做持续伤害处理

___________________________________________________________________________________________

# 目录


- [GAS 171 使用Timer为闪电链制作掉血逻辑，并在首个目标死亡后结束技能](#gas-171-使用timer为闪电链制作掉血逻辑并在首个目标死亡后结束技能)
  - [处理关键点](#处理关键点)
- [目录](#目录)
    - [Mermaid整体思路梳理](#mermaid整体思路梳理)
    - [现在我们需要让技能有伤害，需要配置](#现在我们需要让技能有伤害需要配置)
      - [`DamageEffectClass`](#damageeffectclass)
      - [伤害曲线](#伤害曲线)
      - [先暂时不触发Debuff，并且因为是持续类技能，不想让目标被击飞](#先暂时不触发debuff并且因为是持续类技能不想让目标被击飞)
      - [接下来，创建CD和Cost，并配置](#接下来创建cd和cost并配置)
    - [现在还没有伤害，下一节，处理循环伤害](#现在还没有伤害下一节处理循环伤害)
    - [使用计时器做伤害处理，和MP扣除](#使用计时器做伤害处理和mp扣除)
    - [创建参数，多久扣除一次MP](#创建参数多久扣除一次mp)
      - [计时器](#计时器)
      - [运行测试gif可以掉MP了](#运行测试gif可以掉mp了)
      - [可以扣除消耗时，应用伤害](#可以扣除消耗时应用伤害)
        - [创建函数](#创建函数)
        - [使用 `Spec` 绑定 `SetBuCaller`](#使用-spec-绑定-setbucaller)
        - [需要使用Damage，但是没有对应的函数，需要创建一个](#需要使用damage但是没有对应的函数需要创建一个)
          - [创建函数](#创建函数-1)
      - [最后应用GE](#最后应用ge)
      - [整合成一个函数](#整合成一个函数)
      - [遍历 调用](#遍历-调用)
      - [可以扣除消耗时调用](#可以扣除消耗时调用)
    - [但是现在会无限调用，所以需要创建bool记录敌人是否死亡，死亡则技能停止](#但是现在会无限调用所以需要创建bool记录敌人是否死亡死亡则技能停止)
      - [死亡时停止需要结束技能，结束这部分也需要整合成一个函数](#死亡时停止需要结束技能结束这部分也需要整合成一个函数)
    - [运行测试gif](#运行测试gif)
      - [有一个问题，敌人死亡后没有断开连接](#有一个问题敌人死亡后没有断开连接)
    - [下一节，处理](#下一节处理)



___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[16. Electrocute Cost Cooldown and Damage_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?spm_id_from=333.788.player.switch&vd_source=9e1e64122d802b4f7ab37bd325a89e6c&p=129)

[17. Applying Electrocute Cost and Damage_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?spm_id_from=333.788.player.switch&vd_source=9e1e64122d802b4f7ab37bd325a89e6c&p=130)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

### 现在我们需要让技能有伤害，需要配置

  - `DamageEffectClass`

  - 伤害曲线

  - 配置 触发Debuff 和 击飞 概率

  - 创建CD和Cost，并配置


------

#### `DamageEffectClass`
>![image-20241020034136884](./Image/GAS_171/image-20241020034136884.png)


------

#### 伤害曲线
>![image-20241020034232125](./Image/GAS_171/image-20241020034232125.png)
>![image-20241020034423207](./Image/GAS_171/image-20241020034423207.png)

- 伤害值比较低是因为这是个每0.1s触发一次的伤害，频率比较高

> ![image-20241020034455553](./Image/GAS_171/image-20241020034455553.png)


------

#### 先暂时不触发Debuff，并且因为是持续类技能，不想让目标被击飞
>![image-20241020034520846](./Image/GAS_171/image-20241020034520846.png)


------

#### 接下来，创建CD和Cost，并配置

  - Cost
>![image-20241020034907948](./Image/GAS_171/image-20241020034907948.png)

  - 还缺少曲线
>![img](./Image/GAS_171/25165450_3a6b1f43-2bcd-4469-ab10-cbd9112e3136.png)
>
>我用的是曲线：
>
>![image-20241020035113910](./Image/GAS_171/image-20241020035113910.png)
>
># 注意一下是 `-1` ！
>
>![image-20241020040738954](./Image/GAS_171/image-20241020040738954.png)

  - CD
>![image-20241020035300622](./Image/GAS_171/image-20241020035300622.png)

  - CD还需要配置一个CD的Tag（5.3这里有变动）
>![image-20241020035358861](./Image/GAS_171/image-20241020035358861.png)
>
>`Cooldown.Lightning.Electrocute`
>
>![image-20241020035529836](./Image/GAS_171/image-20241020035529836.png)
>
>![image-20241020035722493](./Image/GAS_171/image-20241020035722493.png)

  - 配置
>![image-20241020035834615](./Image/GAS_171/image-20241020035834615.png)


------

### 现在还没有伤害，下一节，处理循环伤害


------

### 使用计时器做伤害处理，和MP扣除


------

### 创建参数，多久扣除一次MP

  - `DamageDeltaTime`

  - 先使用0.1
>![image-20241020035920299](./Image/GAS_171/image-20241020035920299.png)


------

#### 计时器
>![BPGraphScreenshot_2024Y-10M-20D-04h-00m-47s-666_00](./Image/GAS_171/BPGraphScreenshot_2024Y-10M-20D-04h-00m-47s-666_00.png)
>![BPGraphScreenshot_2024Y-10M-20D-04h-03m-39s-142_00](./Image/GAS_171/BPGraphScreenshot_2024Y-10M-20D-04h-03m-39s-142_00.png)


------

#### 运行测试gif可以掉MP了
>![171-1](./Image/GAS_171/171-1.gif)


------

#### 可以扣除消耗时，应用伤害


------

##### 创建函数

  - `ApplyDamage`

>![image-20241020041013555](./Image/GAS_171/image-20241020041013555.png)


------

##### 使用 `Spec` 绑定 `SetBuCaller` 
>![BPGraphScreenshot_2024Y-10M-20D-04h-14m-06s-871_00](./Image/GAS_171/BPGraphScreenshot_2024Y-10M-20D-04h-14m-06s-871_00.png)


------

##### 需要使用Damage，但是没有对应的函数，需要创建一个
>![image-20241020041526294](./Image/GAS_171/image-20241020041526294.png)


------

###### 创建函数

  - `GetDamageAtLevel`

>![image-20241020041847991](./Image/GAS_171/image-20241020041847991.png)

  - 其实就是之前这里的逻辑
>![img](./Image/GAS_171/25165450_d77954c8-a143-4c92-8ac6-aeba0074a7f9.png)

>```cpp
>public:
>    UFUNCTION(BlueprintPure)
>    float GetDamageAtLevel () const;
>```
>
>```cpp
>float UAuraDamageGameplayAbility::GetDamageAtLevel() const
>{
>    return  Damage.GetValueAtLevel(GetAbilityLevel());
>}
>```


------

#### 最后应用GE
>![BPGraphScreenshot_2024Y-10M-20D-04h-22m-09s-153_00](./Image/GAS_171/BPGraphScreenshot_2024Y-10M-20D-04h-22m-09s-153_00.png)


------

#### 整合成一个函数

  - `ApplyDamageSingleTarget`

>![image-20241020042342738](./Image/GAS_171/image-20241020042342738.png)


------

#### 遍历 调用
>![image-20241020042428618](./Image/GAS_171/image-20241020042428618.png)


------

#### 可以扣除消耗时调用
>![BPGraphScreenshot_2024Y-10M-20D-04h-25m-06s-862_00](./Image/GAS_171/BPGraphScreenshot_2024Y-10M-20D-04h-25m-06s-862_00.png)


------

### 但是现在会无限调用，所以需要创建bool记录敌人是否死亡，死亡则技能停止

  - `TargetDead`

>![BPGraphScreenshot_2024Y-10M-20D-04h-26m-41s-527_00](./Image/GAS_171/BPGraphScreenshot_2024Y-10M-20D-04h-26m-41s-527_00.png)


------

#### 死亡时停止需要结束技能，结束这部分也需要整合成一个函数

  - `ClearTimerAndEndAbility`

>![img](./Image/GAS_171/25165450_331188de-93a2-4a78-edb6-415125b65e22.png)

>![BPGraphScreenshot_2024Y-10M-20D-04h-28m-35s-528_00](./Image/GAS_171/BPGraphScreenshot_2024Y-10M-20D-04h-28m-35s-528_00.png)


------

### 运行测试gif
>![171-2](./Image/GAS_171/171-2.gif)


------

#### 有一个问题，敌人死亡后没有断开连接
>![img](./Image/GAS_171/25165450_9de8bfae-168c-4f50-f725-20a38e063a48.png)


------

### 下一节，处理


___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________