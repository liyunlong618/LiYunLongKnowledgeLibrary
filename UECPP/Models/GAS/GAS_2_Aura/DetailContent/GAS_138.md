___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 138 初始化时和升级时同步技能点；处理选择技能树中同时只能选中一个技能的逻辑

___________________________________________________________________________________________

## 处理关键点

1. 同步流程是，初始化时先绑定然后在初始化的最后阶段广播同步一次数据，然后每次升级触发回调

___________________________________________________________________________________________

# 目录


- [GAS 138 初始化时和升级时同步技能点；处理选择技能树中同时只能选中一个技能的逻辑](#gas-138-初始化时和升级时同步技能点处理选择技能树中同时只能选中一个技能的逻辑)
  - [处理关键点](#处理关键点)
- [目录](#目录)
    - [Mermaid整体思路梳理](#mermaid整体思路梳理)
    - [小测试1](#小测试1)
    - [自己尝试一下](#自己尝试一下)
      - [第一步，WidgetController中声明动态委托（之前挪到基类中了），准备UI蓝图中绑定](#第一步widgetcontroller中声明动态委托之前挪到基类中了准备ui蓝图中绑定)
      - [第二步，PS中声明委托](#第二步ps中声明委托)
      - [第三步，`SpellMenuWidgetController` 中初始化绑定时，直接绑定委托](#第三步spellmenuwidgetcontroller-中初始化绑定时直接绑定委托)
      - [现在可以接收了，但是还没有广播初始值](#现在可以接收了但是还没有广播初始值)
      - [`SpellMenuWidgetController` 中广播函数，广播初始值](#spellmenuwidgetcontroller-中广播函数广播初始值)
      - [现在可以广播初始值了，但是升级时，也需要同步消息，](#现在可以广播初始值了但是升级时也需要同步消息)
      - [升级时，同步广播技能点](#升级时同步广播技能点)
      - [技能树菜单中，绑定回调，更新数字](#技能树菜单中绑定回调更新数字)
    - [此时效果gif](#此时效果gif)
      - [需要测试一下，打开UI时升级看消息是否同步，可以测试下（记得改回来）](#需要测试一下打开ui时升级看消息是否同步可以测试下记得改回来)
    - [下一节](#下一节)
    - [现在想创建一个效果就是，当选中主动技能树中的技能一个图标时，会取消其他的选择，也就是同时期内只会选中一个](#现在想创建一个效果就是当选中主动技能树中的技能一个图标时会取消其他的选择也就是同时期内只会选中一个)
      - [技能球中创建Select的函数，用来控制选中的效果](#技能球中创建select的函数用来控制选中的效果)
    - [现在点击可以播放事件，如果想做最终效果，需要在技能球上创建一个事件分发器，然后在技能树 `主动技能树` 上绑定回调](#现在点击可以播放事件如果想做最终效果需要在技能球上创建一个事件分发器然后在技能树-主动技能树-上绑定回调)
    - [但现在有个问题无法区分谁被选中](#但现在有个问题无法区分谁被选中)
      - [除了被选中的广播过来的，其余的都取消选择](#除了被选中的广播过来的其余的都取消选择)
    - [下面我们需要为被动技能树加入一样的功能](#下面我们需要为被动技能树加入一样的功能)
    - [下一节，将会处理，主动技能树和被动技能树加起来只保留一个选中的问题](#下一节将会处理主动技能树和被动技能树加起来只保留一个选中的问题)
    - [下一节](#下一节-1)
    - [小测试1](#小测试1-1)
    - [自己尝试一下](#自己尝试一下-1)
      - [这里我的解决方案不太一样，我是给每个子类保存了一个SpellMenu的指针，然后在SpellMenu上创建委托，同时广播触发的是哪个技能树面板自身。我这样是统一管理，带来的问题是有点耦合](#这里我的解决方案不太一样我是给每个子类保存了一个spellmenu的指针然后在spellmenu上创建委托同时广播触发的是哪个技能树面板自身我这样是统一管理带来的问题是有点耦合)
      - [视频的方法是，为每个技能树面板创建委托（事件分发器）并在SpellMenu上绑定回调，如果触发对应回调执行各自不同逻辑即可，松耦合](#视频的方法是为每个技能树面板创建委托事件分发器并在spellmenu上绑定回调如果触发对应回调执行各自不同逻辑即可松耦合)
    - [此时效果gif](#此时效果gif-1)



___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[17. Show Spell Points_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?p=84&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

[18. Selecting Icons_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?p=85&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

[19. Deselecting Icons_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?p=86&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________


### 小测试1

  - 该同步技能点了，要求

![img](./Image/GAS_138/25165450_dbc7a8b0-2ef5-4948-c87f-95c90984f893.png)

  - 初始化时同步技能点（打开菜单时，广播当前技能点数）

  - 升级时更新

  - 可参考属性点

>![img](./Image/GAS_138/25165450_91f8578c-ca1f-4855-9bb8-94555d6b2a11.png)


------

### 自己尝试一下


------

#### 第一步，WidgetController中声明动态委托（之前挪到基类中了），准备UI蓝图中绑定
>![img](./Image/GAS_138/25165450_92802e50-ee05-4356-b48f-7d387d0ddda4.png)


------

#### 第二步，PS中声明委托
>![img](./Image/GAS_138/25165450_908cd400-6b0e-4be6-ad93-6965476401e5.png)


------

#### 第三步，`SpellMenuWidgetController` 中初始化绑定时，直接绑定委托
>![img](./Image/GAS_138/25165450_8e9bf196-9707-468b-e310-3ce39518221a.png)


------

#### 现在可以接收了，但是还没有广播初始值


------

#### `SpellMenuWidgetController` 中广播函数，广播初始值
>![img](./Image/GAS_138/25165450_c6125879-bca6-40be-a214-b12649252339.png)


------

#### 现在可以广播初始值了，但是升级时，也需要同步消息，

  - 当我们升级时处理这个


------

#### 升级时，同步广播技能点
>![img](./Image/GAS_138/25165450_7e05b45c-a251-4b52-fba4-11088c00992b.png)

- 因为升级时，调用了 `AddToSpellPoints` 这个函数
>![img](./Image/GAS_138/25165450_95186187-73a3-4aa3-b890-518b58abe1f7.png)


------

#### 技能树菜单中，绑定回调，更新数字
>![img](./Image/GAS_138/25165450_fad2a0de-4800-4721-b0e9-be0a5994cdfe.png)


------

### 此时效果gif
>![img](./Image/GAS_138/25165450_f8e1e4f3-8d8d-4995-cc8b-0f4f7889f4bb.gif)


------

#### 需要测试一下，打开UI时升级看消息是否同步，可以测试下（记得改回来）


------

### 下一节


------

### 现在想创建一个效果就是，当选中主动技能树中的技能一个图标时，会取消其他的选择，也就是同时期内只会选中一个


------

#### 技能球中创建Select的函数，用来控制选中的效果
>![img](./Image/GAS_138/25165450_54db0bd4-ef8f-41f7-8ff9-c58ea4c324ae.png)
>![img](./Image/GAS_138/25165450_5f94f6d3-3ee1-40b0-c6a0-8ab3158c6e3d.png)
>![img](./Image/GAS_138/25165450_f588a176-9e78-462c-da4d-ef99cb78adde.png)
>![img](./Image/GAS_138/25165450_f69a19e1-cbb2-4be0-dadf-dc73771e1ee4.png)


------

### 现在点击可以播放事件，如果想做最终效果，需要在技能球上创建一个事件分发器，然后在技能树 `主动技能树` 上绑定回调
>![img](./Image/GAS_138/25165450_d945cf14-2702-4f6c-e2d5-aabbc8b5b454.png)

- 命名为，`OnSpellGlobeSelected`

>![img](./Image/GAS_138/25165450_e589ccca-9d6a-48e8-f911-6626a5a82af1.png)
>![img](./Image/GAS_138/25165450_c6de304c-8b6b-4dc6-9842-7704debb820f.png)


------

### 但现在有个问题无法区分谁被选中

  - 所以需要添加广播参数，为被选中的技能球UI

>![img](./Image/GAS_138/25165450_40d649b1-e0e2-41e2-e5b2-9a5e77367483.png)


------

#### 除了被选中的广播过来的，其余的都取消选择
>![img](./Image/GAS_138/25165450_3900f618-b349-4561-9ecb-3a65955f34cc.png)


------

### 下面我们需要为被动技能树加入一样的功能
>![img](./Image/GAS_138/25165450_ee55e3d3-4893-4af2-8ea6-21645a704e68.png)


------

### 下一节，将会处理，主动技能树和被动技能树加起来只保留一个选中的问题


------

### 下一节


------

### 小测试1

  - 处理，主动技能树和被动技能树加起来只保留一个选中的问题


------

### 自己尝试一下


------

#### 这里我的解决方案不太一样，我是给每个子类保存了一个SpellMenu的指针，然后在SpellMenu上创建委托，同时广播触发的是哪个技能树面板自身。我这样是统一管理，带来的问题是有点耦合


------

#### 视频的方法是，为每个技能树面板创建委托（事件分发器）并在SpellMenu上绑定回调，如果触发对应回调执行各自不同逻辑即可，松耦合
>![img](./Image/GAS_138/25165450_ace0b2b5-8287-48c6-b496-a9fef13f13f4.png)
>![img](./Image/GAS_138/25165450_172fd78d-59fb-4d83-e45a-9aa84fc2e74d.png)
>![img](./Image/GAS_138/25165450_a81b4ea5-bdff-4794-aa96-5a827d322839.png)
>![img](./Image/GAS_138/25165450_5ad72c1c-cc14-4f9b-ce2e-a1f35d5d9c38.png)


------

### 此时效果gif
>![img](./Image/GAS_138/25165450_be276988-17be-4ede-9e50-d9446dbf73a5.gif)

___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________