___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 111 视线物体显隐材质；取消显示物体投影

___________________________________________________________________________________________

## 处理关键点

1. 视线物体显隐的逻辑处理

2. 使用溶解纹理节点 `DitherTemporalAA` 处理Mask材质的半透效果

___________________________________________________________________________________________

# 目录


- [GAS 111 视线物体显隐材质；取消显示物体投影](#gas-111-视线物体显隐材质取消显示物体投影)
  - [处理关键点](#处理关键点)
  - [目录](#目录)
    - [Mermaid整体思路梳理](#mermaid整体思路梳理)
    - [有一个问题是，当现在人走到某个阻挡的物体后面，相机会拉近，接下来我们将使用材质来解决这个问题](#有一个问题是当现在人走到某个阻挡的物体后面相机会拉近接下来我们将使用材质来解决这个问题)
    - [先设置所有SM忽略相机通道](#先设置所有sm忽略相机通道)
    - [在这个路径下创建过渡用的BP，命名为，***BP\_FadeActor***](#在这个路径下创建过渡用的bp命名为bp_fadeactor)
    - [首先为了淡出材质，其实最好的办法是是用透明材质，但是透明材质会导致场景中的开销变大，所以不能使用透明材质而使用Mask，通过节点 `DitherTemporalAA` 来调整半透](#首先为了淡出材质其实最好的办法是是用透明材质但是透明材质会导致场景中的开销变大所以不能使用透明材质而使用mask通过节点-dithertemporalaa-来调整半透)
    - [根据要使用的材质，复制一个新的，方式使用 `Mask`](#根据要使用的材质复制一个新的方式使用-mask)
    - [使用 `DitherTemporalAA` 节点，这个节点会溶解纹理](#使用-dithertemporalaa-节点这个节点会溶解纹理)
      - [将要修改的参数命名为 `Fade`](#将要修改的参数命名为-fade)
      - [创建该材质的材质实例](#创建该材质的材质实例)
    - [可以在 `BeginPlay` 时运行测试](#可以在-beginplay-时运行测试)
      - [在构造函数中获取所有的材质，创建 `动态材质实例` 运行时设置材质为 `动态材质实例`](#在构造函数中获取所有的材质创建-动态材质实例-运行时设置材质为-动态材质实例)
      - [使用 `TimeLine` 来制作显隐的过渡效果](#使用-timeline-来制作显隐的过渡效果)
    - [下一节：处理何时执行上面的逻辑](#下一节处理何时执行上面的逻辑)
    - [先创建一个接口，命名为，***Bl\_FadeInterface***](#先创建一个接口命名为bl_fadeinterface)
      - [创建两个接口函数](#创建两个接口函数)
      - [蓝图中继承接口](#蓝图中继承接口)
    - [接下来先说一下思路](#接下来先说一下思路)
    - [检测制作](#检测制作)
      - [挂在弹簧臂下面即可，然后设置碰撞，确保与 `SM` 检测](#挂在弹簧臂下面即可然后设置碰撞确保与-sm-检测)
      - [重叠时判断目标是否实现了接口](#重叠时判断目标是否实现了接口)
    - [测试效果gif](#测试效果gif)
    - [现在有个问题：物体隐藏后地面上还有阴影。当我们使用蒙版材质时，阴影与整个淡出机制并不能很好地配合，出于这个原因，我希望所有淡入淡出的Actor都 `不要投射阴影`](#现在有个问题物体隐藏后地面上还有阴影当我们使用蒙版材质时阴影与整个淡出机制并不能很好地配合出于这个原因我希望所有淡入淡出的actor都-不要投射阴影)
      - [关闭阴影](#关闭阴影)
    - [现在有一个问题，有的物体，比如楼梯，会挡住视野，但是需要设置，我想点击的时候可以移动上去，也就是需要 `Visibility` 检测 `Block` ，但是又不想让他挡住视野](#现在有一个问题有的物体比如楼梯会挡住视野但是需要设置我想点击的时候可以移动上去也就是需要-visibility-检测-block-但是又不想让他挡住视野)
    - [在场景中溜达gif](#在场景中溜达gif)



___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[4. Fade Actor_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP/?p=31&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

[5. Fading Out Obstructing Geometry_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP/?p=32&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

```mermaid
graph TD
    A[解决相机拉近问题] --> B[设置所有SM忽略相机通道]
    B --> B1[会把人挡住]
    B --> C[创建BP_FadeActor]
    C --> C1[添加SM]
    C --> C2[设置碰撞为自定义WorldStatic]
    C2 --> C3[阻挡抛射物通道]
    C2 --> C4[不影响相机和点击]
    C2 --> C5[开启重叠检测事件]

    C --> D[使用Mask和DitherTemporalAA调整半透]
    D --> D1[复制材质并使用Mask]
    D --> D2[使用DitherTemporalAA溶解纹理]
    D --> D3[设置参数为Fade]

    D --> E[创建材质实例]
    

```

```mermaid
graph TD
    E[创建材质实例] --> F[在BeginPlay测试]
    F --> G[构造函数中获取材质并创建动态材质实例]
    G --> H[配置新材质给SM]

    H --> I[使用TimeLine制作显隐效果]
    I --> I1[设置过渡时间为0.5s]

    I --> J[创建Bl_FadeInterface接口]
    J --> J1[创建Fadeln和FadeOut接口函数]
    J --> J2[蓝图中继承接口]

    J --> K[检测与逻辑]
    K --> K1[在角色和相机中间放BoxCollision]
    K1 --> K2[挂在弹簧臂下，设置碰撞]
    K2 --> K3[重叠时判断目标是否实现了接口]

    K --> L[当前问题：隐藏物体阴影处理]
    L --> L1[关闭阴影]
    L --> M[特殊物体处理]
    M --> M1[楼梯Visibility检测Block但不挡视野]
    M --> M2[复原楼梯碰撞通道]

```



___________________________________________________________________________________________


### 有一个问题是，当现在人走到某个阻挡的物体后面，相机会拉近，接下来我们将使用材质来解决这个问题

>- #### 正常的俯视角游戏，都有一个将中间的 `SM` 暂时隐藏的功能
>![这里是图片](./Image/GAS_111/27.png)


------

### 先设置所有SM忽略相机通道
>![这里是图片](./Image/GAS_111/1.png)
>
>- #### 但是会把人挡住
>![这里是图片](./Image/GAS_111/2.png)


------

### 在这个路径下创建过渡用的BP，命名为，***BP_FadeActor***

>  - #### 添加 `SM`
>
>  - #### 设置碰撞为 `自定义WorldStatic`
>    
>    - #### 阻挡抛射物通道
>    
>    - #### 不要影响相机和点击，也就是 `Visibility通道` 和 `Camera通道`
>    
>    - #### 因为想要火球打上去会有反应，所以需要 `开启重叠检测事件`
>
>  ![这里是图片](./Image/GAS_111/3.png)![这里是图片](./Image/GAS_111/4.png)![这里是图片](./Image/GAS_111/5.png)


------

### 首先为了淡出材质，其实最好的办法是是用透明材质，但是透明材质会导致场景中的开销变大，所以不能使用透明材质而使用Mask，通过节点 `DitherTemporalAA` 来调整半透


------

### 根据要使用的材质，复制一个新的，方式使用 `Mask`
>![这里是图片](./Image/GAS_111/6.png)![这里是图片](./Image/GAS_111/7.png)


------

### 使用 `DitherTemporalAA` 节点，这个节点会溶解纹理
>![这里是图片](./Image/GAS_111/8.png)
>- #### 右键，开启预览
>![这里是图片](./Image/GAS_111/9.png)
>
>- #### Mask0.5 时，会出现半透效果
>![这里是图片](./Image/GAS_111/11.png)


------

#### 将要修改的参数命名为 `Fade` 
>![这里是图片](./Image/GAS_111/12.png)


------

#### 创建该材质的材质实例


------

### 可以在 `BeginPlay` 时运行测试


------

#### 在构造函数中获取所有的材质，创建 `动态材质实例` 运行时设置材质为 `动态材质实例`

> ## 别忘了，一定要给SM配置上，刚创建的新的材质
>![这里是图片](./Image/GAS_111/13.png)![这里是图片](./Image/GAS_111/14.png)


------

#### 使用 `TimeLine` 来制作显隐的过渡效果

>- #### 时间不要太长，短一些0.5s足矣
>
>![这里是图片](./Image/GAS_111/15.png)![这里是图片](./Image/GAS_111/16.png)


------

### 下一节：处理何时执行上面的逻辑

------

### 先创建一个接口，命名为，***Bl_FadeInterface***
>![这里是图片](./Image/GAS_111/17.png)


------

#### 创建两个接口函数

>- #### `Fadeln`
>- #### `FadeOut`
>![这里是图片](./Image/GAS_111/18.png)


------

#### 蓝图中继承接口
>![这里是图片](./Image/GAS_111/19.png)
>
>![这里是图片](./Image/GAS_111/20.png)


------

### 接下来先说一下思路

>- #### **在角色和相机中间放一个 `BoxCollision` 来检测物体，根据重叠状态来切换**![img](https://api2.mubu.com/v3/document_image/25165450_333c963a-490a-4f8e-aeeb-41b7fdb85adf.png)


------

### 检测制作


------

#### 挂在弹簧臂下面即可，然后设置碰撞，确保与 `SM` 检测
>![这里是图片](./Image/GAS_111/21.png)


------

#### 重叠时判断目标是否实现了接口
>![这里是图片](./Image/GAS_111/22.png)


------

### 测试效果gif
>![这里是动图](./Image/GAS_111/24.gif)


------

### 现在有个问题：物体隐藏后地面上还有阴影。当我们使用蒙版材质时，阴影与整个淡出机制并不能很好地配合，出于这个原因，我希望所有淡入淡出的Actor都 `不要投射阴影` 
>![这里是图片](./Image/GAS_111/23.png)


------

#### 关闭阴影
>![这里是图片](./Image/GAS_111/25.png)


------

### 现在有一个问题，有的物体，比如楼梯，会挡住视野，但是需要设置，我想点击的时候可以移动上去，也就是需要 `Visibility` 检测 `Block` ，但是又不想让他挡住视野
>直接看图，其实就是要区别开这两个，如果是楼梯还要复原碰撞通道
>
>![这里是图片](./Image/GAS_111/26.png)


------

### 在场景中溜达gif
>![这里是图片](./Image/GAS_111/28.GIF)
___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________