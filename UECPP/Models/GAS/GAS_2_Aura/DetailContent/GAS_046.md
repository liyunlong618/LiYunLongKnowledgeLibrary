___________________________________________________________________________________________

###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 046 为火球添加GE:敌人设置和初始化AttributeSet:处理碰撞bug
___________________________________________________________________________________________
## 处理关键点
1. 火球携带的不是GE而是`FGameplayEffectSpecHandle`,方便直接使用
2. 重温`初始化AttributeSet`的流程
___________________________________________________________________________________________


# 目录
- [GAS 046 为火球添加GE:敌人设置和初始化AttributeSet:处理碰撞bug](#gas-046-为火球添加ge敌人设置和初始化attributeset处理碰撞bug)
  - [处理关键点](#处理关键点)
- [目录](#目录)
    - [视频链接](#视频链接)
    - [蓝图中创建一个`GameplayEffect`类](#蓝图中创建一个gameplayeffect类)
    - [想要 抛射物-火球 携带一个`FGameplayEffectSpecHandle`游戏效果规格手柄。](#想要-抛射物-火球-携带一个fgameplayeffectspechandle游戏效果规格手柄)
    - [在抛射物火球中保存一个`FGameplayEffectSpecHandle`变量,设置为生成时公开,`public` 方便外部访问和调用](#在抛射物火球中保存一个fgameplayeffectspechandle变量设置为生成时公开public-方便外部访问和调用)
    - [抛射物的GA中声明可以在蓝图中配置GE的变量](#抛射物的ga中声明可以在蓝图中配置ge的变量)
    - [`UAuraProjectileSpell`中`SpawnProjectile`生成火球的函数中,生成火球前,获取角色`AvatarActor`的ASC组件,生成`FGameplayEffectSpecHandle`给火球的实例`SpecHandle`赋值](#uauraprojectilespell中spawnprojectile生成火球的函数中生成火球前获取角色avataractor的asc组件生成fgameplayeffectspechandle给火球的实例spechandle赋值)
    - [`Overlap`时权威端销毁前需要检查目标是否有ASC组件,然后使用`FGameplayEffectSpecHandle`应用伤害](#overlap时权威端销毁前需要检查目标是否有asc组件然后使用fgameplayeffectspechandle应用伤害)
    - [在AS组件中,当属性发生变化时,`UE_Log`下](#在as组件中当属性发生变化时ue_log下)
    - [这之前并没有为敌人初始化属性](#这之前并没有为敌人初始化属性)
    - [为敌人初始化属性](#为敌人初始化属性)
    - [*BP\_EnemyBase*为敌人的基类 赋值](#bp_enemybase为敌人的基类-赋值)
    - [*GA\_FireBolt*中配置要应用伤害的GE](#ga_firebolt中配置要应用伤害的ge)
    - [使用技能结束后,调用`EndAbility`](#使用技能结束后调用endability)
    - [此时测试`UE_Log`打印敌人血量](#此时测试ue_log打印敌人血量)
    - [现在有bug,敌人不会初始化属性,主要属性正常,次要属性不对,原因是,敌人基类中,这个函数调错了](#现在有bug敌人不会初始化属性主要属性正常次要属性不对原因是敌人基类中这个函数调错了)
    - [这里之前有个bug,就是上一节在设置碰撞的问题,因为设置`Mesh`也检测,`Capsule`也检测,会触发两次检测,会有异常,解决办法是:设置`Capsule`关闭碰撞检测](#这里之前有个bug就是上一节在设置碰撞的问题因为设置mesh也检测capsule也检测会触发两次检测会有异常解决办法是设置capsule关闭碰撞检测)
    - [此时LS模式的gif,客户端和服务器可以合作打怪了](#此时ls模式的gif客户端和服务器可以合作打怪了)


___________________________________________________________________________________________



### 视频链接

  - [视频链接](https://b23.tv/rjgs6gR)

___________________________________________________________________________________________


### 蓝图中创建一个`GameplayEffect`类


![图片](./Image/GAS_046/01.png)


![图片](./Image/GAS_046/02.png)


![图片](./Image/GAS_046/03.png)

___________________________________________________________________________________________


### 想要 抛射物-火球 携带一个`FGameplayEffectSpecHandle`游戏效果规格手柄。

![图片](./Image/GAS_046/04.jpg)

___________________________________________________________________________________________


### 在抛射物火球中保存一个`FGameplayEffectSpecHandle`变量,设置为生成时公开,`public` 方便外部访问和调用

- 如果报错,记得引头文件

![图片](./Image/GAS_046/05.png)

#### 图里元数据错了，没设置为 `true`

```cpp
public:
    UPROPERTY(BlueprintReadWrite, meta=(ExposeOnSpawn = true))
    FDamageEffectParams DamageEffectParams;
```

___________________________________________________________________________________________


### 抛射物的GA中声明可以在蓝图中配置GE的变量


![图片](./Image/GAS_046/06.png)

___________________________________________________________________________________________


### `UAuraProjectileSpell`中`SpawnProjectile`生成火球的函数中,生成火球前,获取角色`AvatarActor`的ASC组件,生成`FGameplayEffectSpecHandle`给火球的实例`SpecHandle`赋值


![图片](./Image/GAS_046/07.png)

___________________________________________________________________________________________


### `Overlap`时权威端销毁前需要检查目标是否有ASC组件,然后使用`FGameplayEffectSpecHandle`应用伤害


![图片](./Image/GAS_046/08.png)

___________________________________________________________________________________________


### 在AS组件中,当属性发生变化时,`UE_Log`下


![图片](./Image/GAS_046/09.png)

___________________________________________________________________________________________


### 这之前并没有为敌人初始化属性

![图片](./Image/GAS_046/10.jpg)

___________________________________________________________________________________________


### 为敌人初始化属性


![图片](./Image/GAS_046/11.png)

___________________________________________________________________________________________


### *BP_EnemyBase*为敌人的基类 赋值


![图片](./Image/GAS_046/12.png)

___________________________________________________________________________________________


### *GA_FireBolt*中配置要应用伤害的GE


![图片](./Image/GAS_046/13.png)

___________________________________________________________________________________________


### 使用技能结束后,调用`EndAbility`


![图片](./Image/GAS_046/14.jpg)

  - 我是这么干的

![图片](./Image/GAS_046/15.png)

___________________________________________________________________________________________


### 此时测试`UE_Log`打印敌人血量


![图片](./Image/GAS_046/16.jpg)

___________________________________________________________________________________________


### 现在有bug,敌人不会初始化属性,主要属性正常,次要属性不对,原因是,敌人基类中,这个函数调错了

![图片](./Image/GAS_046/17.png)

___________________________________________________________________________________________


### 这里之前有个bug,就是上一节在设置碰撞的问题,因为设置`Mesh`也检测,`Capsule`也检测,会触发两次检测,会有异常,解决办法是:设置`Capsule`关闭碰撞检测

  

![图片](./Image/GAS_046/18.jpg)


#### C++中设置`Capsule`关闭碰撞检测

![图片](./Image/GAS_046/19.png)

___________________________________________________________________________________________


### 此时LS模式的gif,客户端和服务器可以合作打怪了

  


![图片](./Image/GAS_046/20.gif)



![图片](./Image/GAS_046/21.png)

___________________________________________________________________________________________

[返回最上面](#Go主菜单)
___________________________________________________________________________________________