<details>
<summary>过程截图</summary>

>

------

</details>




+ `头文件`中：
```cpp
这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码
```

+ `源文件`中：
```cpp
这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码
```

[Mermaid格式参考](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/Mermaid%E6%A0%BC%E5%BC%8F%E5%8F%82%E8%80%83.md)

[预览](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/tree/main/UECPP/Models/GAS/GAS_2_Aura)



___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 131 使用后处理函数 `PostAttributeChange` 修复设置血量魔法最大值异常的bug；修复LOG  `SetByCaller` 报错

___________________________________________________________________________________________

## 处理关键点

1. 111111111111111111111111111111

2. 222222222222222222222222222

3. 33333333333333333333333333

4. 4444444444444444444444444444

5. 555555555555555555555555555555

6. 666666666666666666666666666

7. 77777777777777777777777777777777

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[5. Top Off Our Fluids_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?p=66&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

### 我们之前在这里处理了升级后将hp和mp设为最大值，但是没有生效
>![img](https://api2.mubu.com/v3/document_image/25165450_a264d52e-9813-4ab3-a345-ad04e038a10e.png)


------

### 断点检查一下
>![img](https://api2.mubu.com/v3/document_image/25165450_55e45316-7589-4583-c233-c5c91d2b8f59.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_be845a83-4614-4519-a6b9-4f8e72c81b89.png)


------

### 会发现先触发的AS，后触发的MMC_MaxHealth，这说明我们先基于目前的等级设置了最大值的血量，然后升级，会导致我们的血量无法恢复当前等级的最大值

- ##### 解决办法是，应该在设置属性的后处理函数，不是之前使用的 `PostGameplayEffectExecute` 函数，这个函数是在应用前调用的，我们要再重写 `PostAttributeChange` 函数才是属性值修改后调用的

>![img](https://api2.mubu.com/v3/document_image/25165450_9c59088a-f842-44bb-df6c-a0fe8b02a59b.png)

  - 但是会有个问题，这个函数会在属性变化后修改，假设我们在这里，检查最大值是否发生修改，然后将HP设为最大值的话，目前我们还没有游戏中修改HP最大值的道具，一旦有，就会收到这里的影响，所以需要使用Bool来记录是否需要设置血量到最大值和魔法最大值的状态


------

#### 重写基类的 `PostAttributeChange` 函数，AS中创建bool记录变量

  - 命名为

    - `bTopOffHealth`

    - `bTopOffMana`


>![img](https://api2.mubu.com/v3/document_image/25165450_25211bae-cef4-41c5-f657-c3878eabf50e.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_ec2feedc-bac4-47b6-9501-c171f9cdffbe.png)


------

#### 在需要设置最大值时，设置bool
>![img](https://api2.mubu.com/v3/document_image/25165450_23648044-80ce-4c35-d437-257e5d42fba8.png)


------

#### 在中如果检测到变化，且bool为true，则设置为最大值同时设置bool为false，保证只执行一次
>![img](https://api2.mubu.com/v3/document_image/25165450_1caace08-1ba5-457f-91ae-00bd8c5d387d.png)


------

### 此时效果gif
>![img](https://api2.mubu.com/v3/document_image/25165450_2170a4da-81a8-4c29-d3c0-18d137e3c476.png)


------

### 此时打开log日志，会发现报错
>![img](https://api2.mubu.com/v3/document_image/25165450_b1271510-2969-41b7-de44-c2746c34c408.png)

- 需要修改这里的逻辑

  - 有两种选择：

    - 改为c++逻辑

    - 蓝图中保证不会有不触发的Tag输入
>![img](https://api2.mubu.com/v3/document_image/25165450_e9efc49a-d01d-4f27-f8f1-b37499e59972.png)


------

### 蓝图修复日志报错
>![img](https://api2.mubu.com/v3/document_image/25165450_f707313a-17b8-4d1d-89b8-0a9286f12ec4.png)


------

### 打印测试无报错gif
>![img](https://api2.mubu.com/v3/document_image/25165450_1147a368-ae19-43f8-e3e3-407ee429ec85.png)


___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________