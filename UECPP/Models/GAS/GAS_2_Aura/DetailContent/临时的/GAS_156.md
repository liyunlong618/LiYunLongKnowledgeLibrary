<details>
<summary>过程截图</summary>

>

------

</details>




+ `头文件`中：
```cpp
这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码
```

+ `源文件`中：
```cpp
这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码
```

[Mermaid格式参考](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/Mermaid%E6%A0%BC%E5%BC%8F%E5%8F%82%E8%80%83.md)

[预览](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/tree/main/UECPP/Models/GAS/GAS_2_Aura)



___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 156 敌人死亡时（Mesh开启模拟物理后）将Mesh沿火球方向击飞（结构体和 `Context` 携带击飞方向）；使用GA的Tag打断制作：Debuff不会触发受击GA

___________________________________________________________________________________________

## 处理关键点

1. 当Mesh开启物理模拟后，对Mesh施加一个方向力
    - 在Mesh上调用 `Addlmpulse()`
2. 文件之间的依赖关系？了解下
3. GA中技能之间的相互阻挡和打断配置
4. 授予标签底层源码如何实现？（也就是持续GE应用Tag时添加的Tag在这个容器里）`Inheritable0wnedTagsContainer`

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[10. Death Impulse Magnitude_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP/?p=110&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

[11. Death Impulse in the Effect Context_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP/?p=111&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

[12. Handling Death Impulse_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP/?p=112&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

### 当角色死亡时，希望对敌人施加一个方向力，使敌人在死亡时，沿着特定方向被击飞（比如敌人死亡时，被打飞到墙上，然后弹到地面上），实现布娃娃系统

  - 需要在GA中携带：
    - 击飞力的大小

  - 火球携带的结构体中，也需要携带

    - 击飞力的大小

    - 击飞力的方向

  -  `Context` 中需要携带：
    - 击飞力的方向


------

#### GA中创建变量

  - 命名为，`DeathImpulseMagnitude`
>![img](https://api2.mubu.com/v3/document_image/25165450_4dca7877-a110-401a-efaf-eeda39c1e0d6.png)

------

#### 火球携带的结构体中，也需要携带

  - 命名为，`DeathImpulseMagnitude`
>![img](https://api2.mubu.com/v3/document_image/25165450_2e8cf5ae-e1b8-437b-d6e9-17668ac8400f.png)

------

#### 为结构体赋值时，也需要设置
>![img](https://api2.mubu.com/v3/document_image/25165450_4c7aa504-ce55-473f-b82f-b603f800b754.png)

------

### 下一节


------

### 这一节，我们将在 `Context` 中携带 `击飞力的方向`


------

####  `Context` 中创建 `击飞力的方向` 变量

  - 命名为，`DeathImpulse`
>![img](https://api2.mubu.com/v3/document_image/25165450_0d821673-d3a3-4386-e947-24cf6fe75e37.png)

------

#### 网络序列化函数中需要设置
>![img](https://api2.mubu.com/v3/document_image/25165450_2d3cec47-4b15-4fdf-e116-934ff9da9494.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_c98256fb-ba1d-40ef-e5b2-77ffa9228cf3.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_7aa291e5-89e9-44d0-95b5-ece0730395dc.png)

------

##### `FVector` 网络序列化时 `不用创建智能指针` ，直接调用网络序列化函数即可


------

### 当火球与目标重叠后，就会应用GE，这之后就无法改变 `Context` 了
>![img](https://api2.mubu.com/v3/document_image/25165450_168b7200-236f-4a72-a600-86fed34563ed.png)

------

#### 需要在这里设置结构体，并在下面应用GE时使用结构体中的参数，所以需要结构体携带该变量（击飞力的方向）


------

##### 结构体携带该变量
>![img](https://api2.mubu.com/v3/document_image/25165450_4e9104ac-cc45-41c6-faad-1e554e52ec2b.png)

------

##### 在重叠时，使用火球的 `ForwardVector * 击飞力的大小` 设置结构体中的参数
>![img](https://api2.mubu.com/v3/document_image/25165450_e6927fc9-7a7d-4202-abdc-a37a30e5c846.png)

------

### 接下来，要在AS中使用获取 `Context` 中的 击飞力的方向和大小


------

#### 我们之前是在 `AuraAbilityTypes` 中创建了 `Get` 和 `Set` 的函数，然后在蓝图函数库中创建静态函数
>![img](https://api2.mubu.com/v3/document_image/25165450_e8060f02-f6d8-4b5d-d9a3-6053e1bbeb36.png)

------

####  `AuraAbilityTypes` 中创建 `Get` 和 `Set` 的函数
>![img](https://api2.mubu.com/v3/document_image/25165450_e13acb82-6440-4266-cd52-47121f472a52.png)

------

#### 蓝图函数库中创建
>![img](https://api2.mubu.com/v3/document_image/25165450_acc46221-d7b3-4cbf-86d5-e333a162e278.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_53279b81-828d-42ea-d864-1157cdb73ceb.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_972c0f09-7f81-4958-849d-f93d169b0401.png)

------

#### 在使用结构体应用GE的函数中，设置 `击飞力的方向`
>![img](https://api2.mubu.com/v3/document_image/25165450_3ff21fc2-b7c9-4a42-f226-3d5a450b915a.png)

------

##### 这样在应用前，设置结构体的击飞力的方向，然后应用GE时，设置上下文携带的击飞力的方向，然后就可以在AS中拿到了


------

### 下一节，敌人死亡时获取并设置击飞方向
>![img](https://api2.mubu.com/v3/document_image/25165450_dfcaeb5c-77e3-457e-abe8-48c172eddd0e.png)

------

### 小测试1

  - 在死亡时，对敌人施加击飞力

  - 小提示：可以在敌人的Mesh上调用 `Addlmpulse()`

  - 不要在不应该存在的地方建立不必要的依赖关系!不希望所说的属性依赖于基本字符或类似的东西,
>![img](https://api2.mubu.com/v3/document_image/25165450_9858f2ea-57df-4ed0-a62c-8ecf07c180ce.png)

------

### 自己尝试一下


------

#### 使用接口来做

- 之前有一个死亡的函数
>![img](https://api2.mubu.com/v3/document_image/25165450_a404264f-a7f5-4240-a2a4-4cd77418faf4.png)

------

##### 可以添加一个形参，传入死亡时的击飞力
>![img](https://api2.mubu.com/v3/document_image/25165450_bd8276bc-03b9-4494-94e7-8fbb540b041c.png)

------

##### 所有引用都需要修改


------

#### 在敌人死亡的 `RPC_Client` 函数中，处理对Mesh的操作，所以给函数加一个形参，传参到 `RPC_Client` 函数中处理会更方便一些
>![img](https://api2.mubu.com/v3/document_image/25165450_0d24831e-e119-47b2-c28b-c591e7c1fe8c.png)

------

#####  `RPC_Client` 函数中添加形参
>![img](https://api2.mubu.com/v3/document_image/25165450_0ce9f1ac-e921-43cd-d9a1-051353b71011.png)

------

#### 在敌人死亡时，对Mesh应用击飞力
>![img](https://api2.mubu.com/v3/document_image/25165450_0bb51dda-2007-40ad-9922-94a47ab29809.png)

------

#### AS中，死亡时，传递 `Context` 中的击飞力方向
>![img](https://api2.mubu.com/v3/document_image/25165450_db483a1b-bd3b-4d77-9582-4e2fa0faca08.png)

------

### 此时运行测试，结果并不明显


------

#### 断点测试一下
>![img](https://api2.mubu.com/v3/document_image/25165450_d9f03a14-f81b-435f-dd52-6c303929cba6.png)

- 发现，当敌人死于Debuff伤害时，不会触发击飞


------

#### 先暂时关闭Debuff
>![img](https://api2.mubu.com/v3/document_image/25165450_7a6c8128-a9eb-4cd3-b75c-b42a3b349a2e.png)

------

### 运行测试，有力，但是太小了，几乎看不出来


------

#### 击飞力设为6000测试
>![img](https://api2.mubu.com/v3/document_image/25165450_ad75d1d1-7937-435b-e56c-7dc616172ee0.png)

------

#### 有个问题：武器击飞了，人没有飞
>![img](https://api2.mubu.com/v3/document_image/25165450_616d32f8-6c73-444a-8970-647973a4eb71.png)

------

### 看一下 `Addlmpulse()` 的参数（在施加力的时候可以忽略其质量）
>![img](https://api2.mubu.com/v3/document_image/25165450_c6e24943-be57-42f4-f832-33bfe5dc53bf.png)

------

### 运行测试gif
>![img](https://api2.mubu.com/v3/document_image/25165450_2db6a510-13a7-4e08-b35c-aa578b8f50de.png)

------

#### 不明显设为18000
>![img](https://api2.mubu.com/v3/document_image/25165450_0e88c35f-5862-4648-95b3-0f18af1886c1.png)

------

#### 测试gif
>![img](https://api2.mubu.com/v3/document_image/25165450_31998094-5a0e-4c76-e570-4e56fb4e4677.png)

------

### 武器使用Mesh1/10的力
>![img](https://api2.mubu.com/v3/document_image/25165450_407f2f90-da20-4c86-99c7-6da0ab481235.png)

------

### 测试gif
>![img](https://api2.mubu.com/v3/document_image/25165450_c0fe4322-19b4-47fa-b942-1bb06c3f0247.png)

------

### 敌人如果因为Debuff死亡，则不会被击飞（这个项目这么设计），所以恢复敌人正常Debuff概率
>![img](https://api2.mubu.com/v3/document_image/25165450_01151e52-fdeb-4b00-ea99-ff95b1b56328.png)

------

### 测试，敌人因为Debuff死亡，不会被击飞
>![img](https://api2.mubu.com/v3/document_image/25165450_dc749839-7397-4c1b-d5a5-44f5cf616519.png)

------

### 测试过后，将火球的Debuff伤害设置为调低些，不用太高，可以根据等级提升伤害
>![img](https://api2.mubu.com/v3/document_image/25165450_02a8dd2a-07b1-4c30-d868-e12900002ffc.png)

------

### 这是有一个bug：敌人死后还有一些NS组件没有停止激活
>![img](https://api2.mubu.com/v3/document_image/25165450_120fb6cf-526b-4fba-d809-ac7eda80b093.png)

- 应该是在不该被激活的时候激活了


------

#### 看一下激活的逻辑
>![img](https://api2.mubu.com/v3/document_image/25165450_1a59e6de-eb62-4ef8-8ce8-7dc5e548bdb1.png)

------

##### 应该在角色没有死亡时才激活，死亡后只可以停止
>![img](https://api2.mubu.com/v3/document_image/25165450_235b2fec-36ba-44bc-d869-26e7ac27c5eb.png)

------

### 还有一个事情要处理：现在当敌人中了Debuff效果后，会(持续)触发受击技能（无法移动），不想要这样，想让Debuff不触发受击技能


------

### 可以使用 GAS 的 GA 中的 阻挡 FGameplayTag


------

#### 在受击GA中配置，阻挡火焰的 `DebuffTag`
>![img](https://api2.mubu.com/v3/document_image/25165450_a3c2dba5-726e-4a88-fe9d-1b0dd4c2b5be.png)

------

### 运行测试gif
>![img](https://api2.mubu.com/v3/document_image/25165450_87f2ae6a-af04-4878-88c3-29bed73d72d1.png)

------

### 授予标签底层源码（也就是持续GE应用Tag时添加的Tag在这个容器里）
>![img](https://api2.mubu.com/v3/document_image/25165450_79780805-6b87-4f18-9b46-8a3002fbf739.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_59d3789c-3fbd-4a14-85d0-5d6f95e9797e.png)
___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________