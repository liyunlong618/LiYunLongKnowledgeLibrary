___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 175 客户端不能EndAbility！火球Actor除了开启复制，还需要开启复制运动！添加眩晕特效；保证玩家也能被眩晕和DS客户端修改逻辑

___________________________________________________________________________________________

## 处理关键点

1. 客户端无法结束技能！需要服务器结束技能
2. 之前我们给 火球Actor设置了开启复制，还需要设置 `复制运动` `ReplicateMovement`
    - 不能在构造中设置，因为这是一个虚函数

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[21. Stun Niagara System_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?spm_id_from=333.788.player.switch&vd_source=9e1e64122d802b4f7ab37bd325a89e6c&p=134)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

### 还有一个bug：DS模式下，当客户端按下闪电技能后立即松开，并没有停止技能释放，（虽然看着像在释放技能但是并没有扣除魔法，说明没有移除Cue）
>![img](https://api2.mubu.com/v3/document_image/25165450_8db2b6f5-29ee-4dd1-dc28-bb1a1538c773.png)

- 因为客户端无法EndAbility，只有服务器可以，所以需要限制客户端逻辑
>![img](https://api2.mubu.com/v3/document_image/febf18f1-ae97-42a8-87f8-e1a151231b7b.jpeg)
>![img](https://api2.mubu.com/v3/document_image/9b51f93e-df33-4ac1-8dd2-5daa128845cd.jpeg)
>![img](https://api2.mubu.com/v3/document_image/e83322b6-3c82-4e20-89e2-bbeb5fd52835.jpeg)

- 因为取消技能时，的delay
>![img](https://api2.mubu.com/v3/document_image/25165450_dceb5d7b-139e-4a5f-b7b7-208d0a7516d6.png)


------

### 运行测试，这次可以结束技能了


------

### 还需要处理一些逻辑


------

#### 当准备结束技能时，要应用GE时需要检查（只有服务器才可以应用GE）
>![img](https://api2.mubu.com/v3/document_image/25165450_54dd6d68-9b23-4865-d91e-eb444610d330.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_8e4559a5-0685-4aa6-a353-4318ef26041e.png)


------

### 在使用火球攻击敌人时，空指针，因为ASC空指针

  - 应该是在客户端，所以需要检查

>![img](https://api2.mubu.com/v3/document_image/25165450_f8c791c8-4b69-4850-f332-1004882c525c.png)


------

#### 只有服务器才能处理重叠
>![img](https://api2.mubu.com/v3/document_image/25165450_24002c02-afe3-49ea-f002-0a339b535960.png)


------

### 我们之前忘记使用引用委托了
>![img](https://api2.mubu.com/v3/document_image/25165450_6a425815-6f49-40a3-8f96-066003f17fc0.png)


------

### 之前我们给 火球Actor设置了开启复制，还需要设置 `复制运动` `ReplicateMovement`

  - 不能在构造中设置，因为这是一个虚函数

  - 也可以在蓝图中配置

>![img](https://api2.mubu.com/v3/document_image/25165450_5a291dc6-f561-4a0e-ccf1-6ef7e781309f.png)

>![img](https://api2.mubu.com/v3/document_image/e35343ea-f82a-450a-9fde-cd5ecb5ea6d6-25165450.jpg)


------

#### 在蓝图中配置 `复制运动` `ReplicateMovement`
>![img](https://api2.mubu.com/v3/document_image/25165450_b1082369-03e0-4ccb-f1ee-44486176cd91.png)


------

### 运行测试gif：现在应该没什么问题了
>![img](https://api2.mubu.com/v3/document_image/25165450_2d8ed7ec-d399-4fec-b337-70070c6dd4df.png)

- 攻击/玩家眩晕


------

### 接下来我们需要为debuff添加特效


------

#### 我们使用之前创建的NS组件，添加眩晕debuff特效NS组件
>![img](https://api2.mubu.com/v3/document_image/25165450_0c3632e4-269d-4adc-e5f3-f4f956e1ecc5.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_9d9bbfb9-2ee5-45b9-b9a2-e44a4160d7ec.png)


------

#### 之前在敌人死亡时，取消激活，也需要停用眩晕的Debuff
>![img](https://api2.mubu.com/v3/document_image/25165450_f2731652-8c8c-4d52-9bac-333949807485.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_11d1c651-1dd3-4ed1-9eb2-9520058d24d8.png)


------

### 蓝图中配置，并调整位置
>![img](https://api2.mubu.com/v3/document_image/25165450_dcfe9d07-2741-434f-e2b3-76d7f3ec1b7d.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_4a97e9ef-f8dd-48d5-838f-432e3fac629e.png)


------

### DS运行测试，客户端眩晕时并没有激活NS，服务器可以正常激活
>![img](https://api2.mubu.com/v3/document_image/25165450_171df2c7-74cf-4378-b566-56d1d40a0265.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_fbc6140a-1375-45e4-9c52-e04a6d1f4d03.png)


------

#### 因为我们还没有在属性复制通知的回调函数写逻辑
>![img](https://api2.mubu.com/v3/document_image/25165450_6b102834-e146-407c-ba1f-8b29d81f1045.png)

- 之前只处理了添加阻挡的Tag，还需要根据属性赋值的bool激活和关闭NS
>![img](https://api2.mubu.com/v3/document_image/25165450_4f55213c-b316-4036-9c1b-9f14eadeae56.png)


------

### 运行测试gif：客户端也可以显示了
>![img](https://api2.mubu.com/v3/document_image/25165450_61e5839e-1c68-418b-ba4b-ee7bebcd23bd.png)


------

### 但是因为之前只有敌人可以烧伤Debuff，没有发现，现在玩家也需要烧伤效果，需要参考击晕使用属性复制回调函数，在客户端执行 激活/关闭 烧伤的NS
>![img](https://api2.mubu.com/v3/document_image/25165450_51457c1e-47db-4f2e-a7c4-a696ed8c4b07.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_30db149d-abb3-4241-a335-fda19522d3b2.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_246b775c-9f8d-4e8a-b157-05b6cd83f56c.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_5073d39a-f028-41a3-c7f4-c9a2323b1dc5.png)


------

### 运行测试gif 
>![img](https://api2.mubu.com/v3/document_image/25165450_14760f65-e92b-4e6b-e5f7-ba97c926ffd3.png)


___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________