___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 144 记录选中技能树中的技能球，处理点击和取消的逻辑；处理技能详情显示升级时的bug

______________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[27. Self Deselect_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?p=94&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________


### 这一节制作当技能球UI已经被选中时，再次选中会取消自身的逻辑


------

### 在 `SpellMenuWidgetController` 中创建函数

  - 函数命名为，`GlobeDeselect`

  - **清空本地保存的结构体数据**

  - **然后广播**


------

#### 清空本地保存的结构体数据

>![img](https://api2.mubu.com/v3/document_image/25165450_b3bd6299-3a6b-4333-ca5e-6022e8dbf930.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_a4937adb-a461-47e0-f73b-6919ea97c46f.png)


------

#### 然后广播 设置 两个按钮为 `false` ， `技能详情为空`

>![img](https://api2.mubu.com/v3/document_image/25165450_ecea54ed-c9a5-42b4-9404-6ea4036eb4a1.png)


------

### 现在，当技能球本身被选中时，蓝图中，需要 `bool` 记录一下，`自身是否被选中的状态`

  - 变量名为，`Selected`

>![img](https://api2.mubu.com/v3/document_image/25165450_49059613-10a6-41e2-b1d9-819ba670b5ef.png)


------

### 当被选中时，再触发，执行取消逻辑，否则执行选择技能逻辑

>![img](https://api2.mubu.com/v3/document_image/25165450_517f0a82-9bf6-489a-aada-d46cd1470a9e.png)


------

### 此时效果gif

>![img](https://api2.mubu.com/v3/document_image/25165450_ba16e6b1-52ac-497a-82cd-cfb8d808dc4b.png)


------

### 未取消选中，配置按键音效

>![img](https://api2.mubu.com/v3/document_image/25165450_da0c3fdc-436e-4908-8ee6-8aa755840b79.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_78b81dd9-88f3-48ed-9677-a3ff01bfe75e.png)


------

### 下面打开 `UI` ，选中闪电技能，然后升级，加点，在取消。测试效果gif

>![img](https://api2.mubu.com/v3/document_image/25165450_cea369be-42fe-4dd1-e630-4acabde23240.png)


------

### 有一个bug，此时如果我们什么也不选择就升级，`当前等级技能详情` 会显示有问题

>![img](https://api2.mubu.com/v3/document_image/25165450_87894312-0bc0-4abe-fa0a-554a6248a071.png)


------

### 在获取技能详情的函数中，我们之前只是默认返回技能锁定的描述，没有处理啥也没选或者 `AbilityTag` 失效的情况

  - 所以如果 `技能Tag失效` 或者 `AbilityTag == None` ，需要返回空的字符串

- 如果失效，也会走图中 `黄色区域的逻辑` ，所以需要分情况处理

>![img](https://api2.mubu.com/v3/document_image/25165450_45619ba7-bf43-4564-fffc-f511de13e140.png)


------

#### 修复bug，分别处理 `空技能` 和 `锁定技能` 逻辑

>![img](https://api2.mubu.com/v3/document_image/25165450_5478680b-1579-407e-d2d5-f853cc26cc10.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_9fc369e6-b01f-4478-f047-99e4ffff7f31.png)


------

### 此时在运行测试，打开菜单，什么也不选择然后升级，技能详情描述为空字符，正常！gif

>![img](https://api2.mubu.com/v3/document_image/25165450_7250bf69-094a-4ea4-c0be-3bad2397afee.png)


___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________