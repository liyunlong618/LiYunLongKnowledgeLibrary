___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 158 在火球子类上重构生成火球逻辑；设计根据技能范围和火球数量计算生成角度

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[1. FireBolt Projectile Spread_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?p=114&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

### 这一节，我们需要修改火球技能，在子类上重构，适配更多的技能扩展（比如升级技能后，出现更多的火球攻击敌人，火球可以简单追踪敌人，并且有重力下坠效果）
>![img](./GAS_158/25165450_df319803-f7a5-4547-e989-fb0064bde254.png)
>![img](./GAS_158/25165450_904368ba-6010-437f-bfc5-2c7d834fc348.png)


------

### 首先需要计算火球发射时的角度

- 之前在 `AuraProjectileSpell` 中为创建火球制作了函数，有三个参数分别是：

  - 1.目标位置（终点）

  - 2.插槽Tag（起点）

  - 3.Pitch角度偏移

- 这一点我和视频中的不太一样，视频中是四个
>![img](https://api2.mubu.com/v3/document_image/25165450_987b0403-c492-4cb4-9ceb-854cbbb071a0.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_172aa7a5-72bf-4d2c-9347-48368b53cea3.png)

- 因为我们新增的火球术，需要在后半段追踪敌人，所以需要增加一个 `敌人指针` 的参数 `HomingTarget`


------

### 在火球中创建函数 `SpawnProiectiles`

  - 不用继承的原因是：参数变多了，没法用继承

>![img](https://api2.mubu.com/v3/document_image/25165450_4c0d6cb5-be43-452a-a8ff-08e9b651239b.png)


------

#### 逻辑方面，先看一下，之前的生成火球函数中有哪些可以复用的部分
>![img](https://api2.mubu.com/v3/document_image/25165450_1af88c04-45b6-453f-c835-78e96fceac02.png)


------

#### 拷贝过来可复用的逻辑后，生成Debug箭头
>![img](https://api2.mubu.com/v3/document_image/25165450_0c1591f8-18cc-4db8-c258-eaf055800adf.png)


------

#### 蓝图逻辑中使用新创建的节点
>![img](https://api2.mubu.com/v3/document_image/25165450_3ef4d997-92bf-46c1-8193-4a7e3a0b518c.png)


------

#### 运行可以看到箭头
>![img](https://api2.mubu.com/v3/document_image/25165450_a10d2645-23ab-40f4-d8bd-6d60962c8425.png)


------

### 因为我们要制作，基于等级生成更多的火球，需要一个可扩散的角度和火球数量（这个可以配置）

  - 可扩散的角度
    - `ProjectileSpread`

  - 火球数量
    - `MaxNumProjectiles`

- 创建变量
>![img](https://api2.mubu.com/v3/document_image/25165450_4810b06c-3445-4d89-fd62-f3c7c1149ebc.png)


------

### 所以释放技能的角度应该是，左右分别 +- （ProjectileSpread可扩散的角度 / 2）
>![img](https://api2.mubu.com/v3/document_image/25165450_4cc27127-6feb-4fa5-ffd2-beb30ee932e3.png)

- 对应代码为：
>![img](https://api2.mubu.com/v3/document_image/25165450_a5086ef7-65b4-4f78-eaf4-feae36557039.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_04635051-876d-4412-bc80-6f4325d5d947.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_2e73b22a-3288-4693-adda-aa7ad36324f4.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_3e6690fc-47bb-4587-b024-5623c05e3067.png)

- 生成测试
>![img](https://api2.mubu.com/v3/document_image/25165450_bfa89248-5beb-44c6-fab8-af8c4efa8d2c.png)


------

### 现在生成火球角度还有一些问题

  - 现在想象一下，如果每一个的旋转角度为DeltaSpread，假设有两个火球，ProjectileSpread可扩散角度为90，那DeltaSpread = 45，第一个和正前方的重合，另一个和右侧角度重合，最左侧没有火球生成


------

### 生成火球角度部分，分成两种情况处理：

  - 数量大于1时
    - 从最左侧开始：角度 = 最左侧角度 + i * DeltaSpread

  - 小于等于1时
    - 朝正前方正常射出火球

  - 火球数量  = 要生成的火球数量 - 1（因为要使用fori循环，所以使用最大数量 - 1）
>![img](https://api2.mubu.com/v3/document_image/25165450_40c4e154-b1db-4035-c275-b83e9c3c461f.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_e4acc2dd-addf-4700-b363-f7b2844b1d93.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_388dfd27-ea75-404b-e9b2-8c9cb11c15db.png)


------

### 通过设置蓝图中的参数，校验生成角度的结果时否正确
>![img](https://api2.mubu.com/v3/document_image/25165450_78739c2b-82ee-4cba-dd4f-43ea19d74942.png)


------

#### 测试结果
>![img](https://api2.mubu.com/v3/document_image/25165450_01e07eaf-8ae8-48ae-ae4d-faa2b53ed79c.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_6260fdf5-b5d2-4468-9294-17b4930751fa.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_1f85ed5f-4905-4c2e-843e-17f0f58e0d30.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_e7c3a00c-0d74-4811-f998-e0e080c4f96c.png)

___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________