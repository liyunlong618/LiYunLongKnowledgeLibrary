<details>
<summary>过程截图</summary>

>

------

</details>




+ `头文件`中：
```cpp
这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码
```

+ `源文件`中：
```cpp
这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码
```

[Mermaid格式参考](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/Mermaid%E6%A0%BC%E5%BC%8F%E5%8F%82%E8%80%83.md)

[预览](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/tree/main/UECPP/Models/GAS/GAS_2_Aura)



___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 077 通过服务获取黑板中的变量；设置黑板中的值
___________________________________________________________________________________________

## 处理关键点

1. 111111111111111111111111111111

2. 222222222222222222222222222

3. 33333333333333333333333333

4. 4444444444444444444444444444

5. 555555555555555555555555555555

6. 666666666666666666666666666

7. 77777777777777777777777777777777

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[4. Blackboard Keys_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1JD421E7yC?p=164&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

[5. Finding the Nearest Player_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1JD421E7yC?p=165&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

### Tip：信息在所有黑板之间同步

> ![img](https://api2.mubu.com/v3/document_image/25165450_a2834395-91ef-4b86-f426-abdc04e1db97.png)

------

### 黑板中默认会有一个 `SelfActor` 的变量

> ![img](https://api2.mubu.com/v3/document_image/25165450_3728c5cc-a3f1-46f3-a51a-202741a31faf.png)
>
> - ### 如果想 `获取黑板变量` 需要创建一个 `BlackboardKeySelector`
>
> - ### 且需要 扣开眼睛
>
> ![img](https://api2.mubu.com/v3/document_image/25165450_bebf17d5-945e-4fa9-aa96-98fbfbbcaf94.png)
>
> - ### 之后就可以在这里配置获取变量
>
> ![img](https://api2.mubu.com/v3/document_image/25165450_c7616ab2-c231-4440-be3d-3ba76fe7bd85.png)
>
> - ### 测试获取变量
>
> ![img](https://api2.mubu.com/v3/document_image/25165450_c7616ab2-c231-4440-be3d-3ba76fe7bd85.png)
>
> ![img](https://api2.mubu.com/v3/document_image/25165450_a56554ac-0d2c-41b7-b1a8-af92730db497.png)
>
> ![img](https://api2.mubu.com/v3/document_image/25165450_7ce6ab95-36ec-42ef-c227-9d841b32157d.png)

------

### 现在需要在黑板中 创建 `目标对象` 与 `目标的距离` 两个变量

> #### 创建两个变量：
>
> - #### `TargetToFollow` 目标对象
>
> - #### `DistanceToTarget` 与目标的距离
>
>
> ![](./GAS_077/1.PNG)

------

### C++中 获取 黑板值

> ### 创建两个获取黑板值的类型变量
>
> - #### `FBlackboardKeySelector` 类
>
>   - #### `TargetToFollowSelector` 目标对象
>
>   - #### `DistanceToTargetSelector`与目标对象的距离
>
> - #### 蓝图可读，编辑器可编辑
>
> ![](./GAS_077/2.PNG)

------

### 现在我们需要判断玩家和敌人类

> - #### 后续可能会有随从或者别的不继承自敌人类的，敌人是否也可以攻击，或者敌人之间能不能相互攻击？
>
>- #### 解决方法是使用引擎中的 `FName` 的 `Tag`

------

### 为敌人基类和角色设置标签

> - #### `敌人基类` —— `Enemy`
>
> - #### `玩家角色` —— `Player`
>
> ![](./GAS_077/4.PNG)![](./GAS_077/3.PNG)

------

### BTService_FindNearestPlayer 中 获取对立阵营的 Tag，然后通过 Tag 获取 Actors

> - ### 如果目标有 `Tag`
>
>   - #### 用 三目运算符 获取 `Tag`
>
>   - #### 判断 `AIOwner->GetPawn()` 的 `Tag`
>
>     ![](./GAS_077/5.PNG)
>
> - #### 如果拿到 `Tag` 直接暴力获取使用API：`UGameplayStatics::GetAllActorsWithTag` ，然后打印
>
>   ![](./GAS_077/6.PNG)
>   
>   ```CPP
>   void UBTService_FindNearestPlayer::TickNode(UBehaviorTreeComponent& OwnerComp, uint8* NodeMemory, float DeltaSeconds)
>   {
>       Super::TickNode(OwnerComp, NodeMemory, DeltaSeconds); /*运行蓝图逻辑*/
>   
>       if (const APawn* OwnerPawn = AIOwner->GetPawn())
>       {
>          //拿到对立阵营的Tag
>          const FName Tag = OwnerPawn->ActorHasTag(FName("Player")) ? FName("Enemy") : FName("Player");
>          TArray<AActor*> OutActors;
>          UGameplayStatics::GetAllActorsWithTag(OwnerPawn, Tag, OutActors);
>          for (const AActor* ActorHasTag : OutActors)
>          {
>             GEngine->AddOnScreenDebugMessage(-1,0.5f,FColor::Red,FString::Printf(TEXT("ActorHasTag%s"),*ActorHasTag->GetName()));
>          }
>       }
>   }
>   ```
>

------

### 行为树的服务中 配置黑板中的变量

> ![](./GAS_077/7.PNG)

------

### 测试结果

> ![](./GAS_077/8.PNG)

------

### 我们需要让敌人在获取Actors的时候对比每个距离，然后获取最近距离的Actor

> ![](./GAS_077/9.PNG)

------

### 最后设置黑板值，调用黑板函数库中的API：

> - #### `UBTFunctionLibrary::SetBlackboardValueAsObject`
>
> - #### `UBTFunctionLibrary::SetBlackboardValueAsFloat`
>
> ![](./GAS_077/10.PNG)

------

### 此时运行测试，可以看到黑板中的值

> ![img](https://api2.mubu.com/v3/document_image/25165450_3788ec74-8398-456c-d963-70ced3860906.png)

------

### 行为树添加MoveTo节点

> ![img](https://api2.mubu.com/v3/document_image/25165450_d1b84042-322f-49f9-f716-e5881e860918.png)

------

### 测试结果gif

> ### 可以看到敌人在火中也会掉血
>
> ![img](https://api2.mubu.com/v3/document_image/25165450_0d2ff8b3-d246-4d79-b36f-045b6c22ee7f.png)
>
> ![img](https://api2.mubu.com/v3/document_image/25165450_0d2ff8b3-d246-4d79-b36f-045b6c22ee7f.png)


___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________