<details>
<summary>过程截图</summary>

>

------

</details>




+ `头文件`中：
```cpp
这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码
```

+ `源文件`中：
```cpp
这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码
```

[Mermaid格式参考](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/Mermaid%E6%A0%BC%E5%BC%8F%E5%8F%82%E8%80%83.md)

[预览](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/tree/main/UECPP/Models/GAS/GAS_2_Aura)



___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 153 FGameplayContext中携带结构体；在AS中读取Context中的参数，准备应用Debuff

___________________________________________________________________________________________

## 处理关键点

1. 网络序列化 结构体
    - 比如 `FHitResult` 这种需要使用 `TSharedPtr` 指针包裹使用！！
2. 网络序列化 FVector
    - 读取数据时直接调用 `NetSerialize` 函数赋值即可
3. 避免主函数中掺杂大量过程逻辑，比较多的过程逻辑，尽可能的抽象到函数中！

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[6. Debuff Info in the Effect Context_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP/?p=106&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

[7. Debuff in the Attribute Set_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP/?p=107&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

### 小测试1

  - 需要在 `AuraAbilityTypes` 的 `FAuraGameplayEffectContext` 中添加这几个要传递的 Debuff 相关的变量：和 `Set` `Get` 函数

    - blsSuccessfulDebuff
      - bool 是否触发Debuff？

    - DebuffDamage
      - 伤害

    - DebuffDuration
      - 持续时间

    - DebuffFrequency
      - 多久生效一次

    - 如果可以的话，可以参考 `FHitResult` ，看一下如何携带这种结构体类的数据，然后携带
      - DamageType
        - 伤害类型
>![img](https://api2.mubu.com/v3/document_image/25165450_1f917fa1-bd1c-4901-8731-14efd284c79e.png)

------

### 自己尝试下


------

#### 先搞定 bool 和float 变量
>![img](https://api2.mubu.com/v3/document_image/25165450_8af752f5-66b9-4721-c55b-dab44e81da0f.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_53c92cf2-210a-4046-fb4d-fdff881c5a3e.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_c9d7a819-fbde-44f2-d0fd-21f5effac1c6.png)

------

#### 接下来 序列化 `FGameplayTag`


------

##### 先参考一下 `FHitResult`
>![img](https://api2.mubu.com/v3/document_image/25165450_615cd826-a986-4ce4-ce28-12ccc43c981b.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_2d716805-f4fa-457d-a8d6-263d0a76ad2e.png)

- 其实是序列化 `TSharedPtr`


------

##### 创建一个 `TSharedPtr` 包裹的 `FGameplayTag` 

  - 别忘了不用加 `UPROPERTY` !!!!!!

  - 因为 `TSharedPtr` 智能指针会自动帮助管理内存和GC
>![img](https://api2.mubu.com/v3/document_image/25165450_9801bdde-7d0f-4dbc-8be0-9c437f47299c.png)

------

##### 如果有效，则翻转第13位
>![img](https://api2.mubu.com/v3/document_image/25165450_ab045cbb-fb94-4e4a-9a70-a570b8f9018f.png)

------

##### 接下来需要从存档中加载 `TSharedPtr` 包裹的 `FGameplayTag` （参考 `FHitResult` ）


------

###### 需要 `new` 一个 `TSharedPtr` 指针包裹 `FGameplayTag`
>![img](https://api2.mubu.com/v3/document_image/25165450_1062d3cb-8f9c-4d13-c46b-fb26d2f264be.png)

------

###### 最后加载数据
>![img](https://api2.mubu.com/v3/document_image/25165450_8b306213-343d-4ef7-91ff-e8c170cc2abf.png)

------

#### 最后别忘了修改序列化传递的有效位数
>![img](https://api2.mubu.com/v3/document_image/25165450_c478a6a5-c1ff-4b7b-a6a0-96cd083e7f1f.png)

------

#### 以上就完成了对变量的序列化，接下来需要创建 `Get` 和`Set` 函数
>![img](https://api2.mubu.com/v3/document_image/25165450_ae749011-2a62-49a2-9562-a84eefd161f0.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_f3e2019d-bd1a-4fc1-e998-a544446694d5.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_591a55ae-eed1-4491-96e9-2a59da5ab258.png)

------

#### 我们之前在蓝图函数库中创建静态函数，可以方便的 `Get` 和 `Set` `FAuraGameplayEffectContext` 中的变量，现在也需要为新变量创建函数
>![img](https://api2.mubu.com/v3/document_image/25165450_601b677c-3f66-499c-e1df-ac8fe8afbd63.png)

- 为新变量创建函数
>![img](https://api2.mubu.com/v3/document_image/25165450_5d9620f7-61e3-4949-99e2-e75972efa46e.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_75ef3b2b-136a-4c60-af21-d12d6e5afee0.png)

------

##### 函数体中也需要使用类型强制转换（转换成自建的Context）
>![img](https://api2.mubu.com/v3/document_image/25165450_81ecbe2a-acd1-4bd4-f9de-3f39b23887a5.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_89097300-b4d4-4dfd-ff1f-590f57bc49d8.png)

------

##### `FGameplayTag` 的处理情况略有不同，因为是操作智能指针 `TSharedPtr` 


------

###### 蓝图函数库 `Get` 函数中，如果获取智能指针指向的 `裸指针` 需要先给智能指针判空，然后因为返回值不是指针，需要解引用
>![img](https://api2.mubu.com/v3/document_image/25165450_2783ef48-2e08-442d-aca5-52bc8b15890d.png)

------

###### 蓝图函数库 `Set` 函数中，因为需要传入一个 `TSharedPtr` 智能指针，所以需要创建一个
>![img](https://api2.mubu.com/v3/document_image/25165450_a52d2ce0-1c80-4a32-a837-8d69d2088069.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_289b2d1d-9fd7-4309-dc74-3e2041e2e9c6.png)

------

### 下一节


------

### 在 `ExecCalc_Damage` 中，写一下触发Debuff之后的逻辑（需要使用蓝图函数库中的函数，设置Context中的参数）
>![img](https://api2.mubu.com/v3/document_image/25165450_d4bb5920-d88a-4cfd-a9ab-896ff2920427.png)

------

### 在AS的后处理函数中，当 `InCommingDamage` 被触发时，也会在这里获取 `Context` 的数据，看是否 `触发了Debuff` ，然后 `创建GE` 应用该次 `Debuff` 
>![img](https://api2.mubu.com/v3/document_image/25165450_5cecdf3f-2b5b-4165-f658-fecfb5c4fc23.png)

------

### 现在AS的后处理函数中逻辑有些臃肿，需要根据被触发的属性，抽象功能函数然后调用。

  - 命名为:

    - `HandleIncomingDamage`

    - `HandleIncomingXP`

  - 调用
>![img](https://api2.mubu.com/v3/document_image/25165450_2e76aac1-6e86-420a-856d-159607041197.png)

------

#### 创建 处理Debuff的函数，触发时调用

  - 命名为，`Debuff`
>![img](https://api2.mubu.com/v3/document_image/25165450_cd50f07e-d579-4b35-bc20-9cdef6a0efff.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_c5b69a4d-08f4-478b-c73e-930fa4517c0b.png)

------

### 下一节，我们来处理为Debuff在C++中创建GE 配置，然后应用
___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________