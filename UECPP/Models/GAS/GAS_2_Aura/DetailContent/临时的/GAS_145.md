___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 145 制作装备技能点击提示动画和相关显示和隐藏的逻辑；显示后动画循环

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[28. Equipped Spell Row Animations_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?p=95&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

[29. Ability Types_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP/?p=96&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________


### 接下来我们将处理装备技能的逻辑

>![img](https://api2.mubu.com/v3/document_image/25165450_4d608be2-dcc8-4bfd-8437-e8ef799d27ab.png)


------

### 当我们点击一个可以装备的技能，我们需要一个UI的动画来提示用户需要点击的区域，区域分为两个

  - 主动技能区域

  - 被动技能区域


------

### 这一节制作UI动画


------

#### 添加Image控件，制作动画

>![img](https://api2.mubu.com/v3/document_image/25165450_9b336453-d8cb-40f7-83ae-07bb833c63b7.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_be22735f-6d6b-44b2-cfe3-d1875c13a07d.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_3f556cd6-6b5f-49b4-e9c2-a66141d18ac7.png)


------

#### `Construct` 时播放动画测试，`Loop` 动画，调试位置

>![img](https://api2.mubu.com/v3/document_image/25165450_11856894-947e-4053-82cc-77f13c0a7b6a.png)


------

### 下一节，处理逻辑


------

### 我们接下来制作：当我们点击主动技能，主动技能区域播放动画，点击被动技能，被动技能区域闪烁

  - 所以还需要为我们的技能信息结构体添加一个技能类型，标注主动和被动技能

>![img](https://api2.mubu.com/v3/document_image/25165450_f27a1d60-1a0d-4560-a9dd-d2d57f133ce6.png)

  - 此外还需要像 `使用技能点按钮` 一样，创建一个蓝图触发的 `BlueprintCallable` 函数


------

#### `技能结构体` 中添加 `技能类型` 的标签Tag

>![img](https://api2.mubu.com/v3/document_image/25165450_46176ffe-5518-41b6-cdbe-82d203388a32.png)


------

#### 创建点击装备按钮时调用的 `BlueprintCallable` 函数

  - 命名为，`EquipButtonPressed`

>![img](https://api2.mubu.com/v3/document_image/25165450_e93ca122-b0dc-4808-eda4-9de7ccd1b818.png)


------

### 梳理下，当我们点击装备按键时，会触发什么逻辑

  - **需要广播选中的技能球的技能类型**

    - **主动技能**

    - **被动技能**

  - **根据技能类型播放不同区域的等待装备技能的动画**

  - **点击后应该禁用按钮，防止多次点击**


------

#### 声明创建动态多播，广播 `技能类型`

  - 命名为，`FWaitForEquiptelectionSignature`

  - 委托命名为，`WaitForEquipDelegate`

>![img](https://api2.mubu.com/v3/document_image/25165450_f41450f8-0d65-4807-c901-ee8cc83e24d8.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_4a0f6342-af6a-4eea-ec8a-59f51ddb67d9.png)


------

#### 点击时，通过选择技能时保存的结构体中的 `AbilityTag` ，从所有技能信息的 `数据资产` 中找到包含的 `结构体Info` ，然后就拿到了 `技能类型`

>![img](https://api2.mubu.com/v3/document_image/25165450_5d7ca3fe-e925-4430-8f77-ea5d57c449ab.png)

- 接下来就需要广播了

>![img](https://api2.mubu.com/v3/document_image/25165450_66d06ee1-9d06-4525-d371-3474a3fb735c.png)


------

#### 我们需要一个 `bool` 变量来记录 `当前等待用户装备技能的状态`

  - 命名为，`bWaitingForEquipSelection`

>![img](https://api2.mubu.com/v3/document_image/25165450_f27b87d8-52c4-4c3c-be32-16dcb70e73a1.png)


------

#### 按下按钮后设为 `true`

>![img](https://api2.mubu.com/v3/document_image/25165450_de794279-8610-4cfb-a4ec-3248234ee590.png)


------

### 蓝图中配置技能类型

>![img](https://api2.mubu.com/v3/document_image/25165450_b392588f-8e60-4732-c9f7-8707ced56cef.png)


------

### `技能Menu` 中绑定委托

>![img](https://api2.mubu.com/v3/document_image/25165450_86fa6bff-5701-47ef-dbf8-bc4ac5ec31be.png)


------

### 创建一个回调函数

  - 函数命名为，`OnWaitForEquip`

>![img](https://api2.mubu.com/v3/document_image/25165450_d367c2a2-b864-41dc-cca7-6b653d7f7f9f.png)


------

#### 回调函数内，根据 `类型` 实施策略

>![img](https://api2.mubu.com/v3/document_image/25165450_0a174331-ba50-4b7d-ff57-b5edd2088dd9.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_52b6a4d2-4809-45e5-db8a-17b6c11f9f59.png)


------

### 最后一步当点击按钮时，调用 `BlueprintCallable` 函数 `EquipButtonPressed`

>![img](https://api2.mubu.com/v3/document_image/25165450_d3880b7b-9e19-49b0-8850-0e67c330de8b.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_099d996b-b3cc-4568-9477-db2d5b5a9a2b.png)


------

### 运行测试，播放动画gif

>![img](https://api2.mubu.com/v3/document_image/25165450_5f934710-a5bc-437a-f418-16d68029912e.png)


------

### 现在是可以播放动画了，但是没有停止，我们需要，参考播放动画的逻辑，在停止播放时，也创建委托广播数据，下面情况需要停止动画

  - 用户取消选择技能球

  - 选择别的技能球

- 参考下播放动画的逻辑

>![img](https://api2.mubu.com/v3/document_image/25165450_c142739d-a774-4158-ce46-26d2f4c34be0.png)


------

#### 创建委托（可以使用之前的动态多播）处理关闭的回调

  - 命名为，`StopWaitingForEquipDelegate`

>![img](https://api2.mubu.com/v3/document_image/25165450_317213b8-3a09-4b22-d6eb-f30f08691bcd.png)


------

#### 在取消技能时，拿到技能的 `技能类型Tag` ，然后广播

>![img](https://api2.mubu.com/v3/document_image/25165450_48e64c7c-294f-46e6-9d77-6746a625fd84.png)


------

#### 在选择技能球时，也需要广播取消

>![img](https://api2.mubu.com/v3/document_image/25165450_27c3ec36-17cf-4ece-9cf6-8aa58fc5d525.png)


------

#### 蓝图中绑定回调

>![img](https://api2.mubu.com/v3/document_image/25165450_e18e3ccd-d10a-4d89-e94c-e65e3d41d665.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_11798432-9d10-4e2f-b3d4-0291daf1440c.png)


------

### 这个时候有一个bug，当我们每次选择技能，都会触发关闭的广播，而这时（因为我们关闭是个动画），所以会在每次点击时 `闪烁` ，需要处理，只有当选择的 `bool` 为 `true` 时，才执行

>![img](https://api2.mubu.com/v3/document_image/25165450_413edb8d-8421-4bf5-f991-29e834aff156.png)

- 增加判断

>![img](https://api2.mubu.com/v3/document_image/25165450_fab87a4a-3155-428a-b274-50b5d8cd5e22.png)

- 取消技能选择时，也需要增加判断

>![img](https://api2.mubu.com/v3/document_image/25165450_f7142bc7-ff0c-4648-c983-41aef211f740.png)


------

#### 别忘了每次判断后，因为状态已经广播发生改变，所以需要 `设置 bool 为 false`

>![img](https://api2.mubu.com/v3/document_image/25165450_01a6533f-d879-4164-d8c9-ec1fbf3edf1c.png)


------

### 此时效果gif

  - 选择其他的按钮后，取消装备技能的动画

>![img](https://api2.mubu.com/v3/document_image/25165450_3b5e91ed-31e7-4731-a55a-3b57fafaaef5.png)


------

### 接下来我们将处理，点击 `装备技能区` ，装备 技能 的逻辑


___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________