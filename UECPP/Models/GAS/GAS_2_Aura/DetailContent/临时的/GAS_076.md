<details>
<summary>过程截图</summary>

>

------

</details>




+ `头文件`中：
```cpp
这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码
```

+ `源文件`中：
```cpp
这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码
```

[Mermaid格式参考](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/Mermaid%E6%A0%BC%E5%BC%8F%E5%8F%82%E8%80%83.md)

[预览](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/tree/main/UECPP/Models/GAS/GAS_2_Aura)



___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 076 创建AIController/行为树/黑板/自定义的行为树服务BTService

___________________________________________________________________________________________

## 处理关键点

1. 111111111111111111111111111111

2. 222222222222222222222222222

3. 33333333333333333333333333

4. 4444444444444444444444444444

5. 555555555555555555555555555555

6. 666666666666666666666666666

7. 77777777777777777777777777777777

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[1. Enemy AI Setup_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1JD421E7yC?p=161&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

[2. AI Controller Blackboard and Behavior Tree_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1JD421E7yC?p=162&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)


------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

### 结构梳理

![img](https://api2.mubu.com/v3/document_image/25165450_16c81aab-ef83-417b-ffbd-8c6762740a93.png)

![](./GAS_076/1.PNG)



>- [x] 创建一个AI控制器类。
>
>- [x] 创建一个黑板（Blackboard）和行为树（Behavior Tree）。
>
>- [x] 绑定AI控制器到黑板和行为树。
>
>- [x] 将行为树添加到Aura Enemy（敌人）。
>
>- [x] 运行行为树。
>
>- [x] 添加一个黑板组件和行为树组件。

------

### 创建自己的 `AIController` 的C++类

>- ### 在 `Aura/Public/AI/` 文件夹下
>
>- ### 创建自己的 `AIController` 的C++类，命名为 `AuraAIController`
>
>![img](https://api2.mubu.com/v3/document_image/25165450_9a2e152b-04c3-4ecc-9e73-80a9dc74982a.png)



------

## 需要引入模块 `AIModule`

> ![img](https://api2.mubu.com/v3/document_image/25165450_bfef9bd4-a192-4241-d57f-9aeaaf41ed3e.png)

------

### 自建的 AuraAIController 中创建行为树组件(不需要黑板组件)

> ![img](https://api2.mubu.com/v3/document_image/25165450_e5fdbf61-0d33-4284-d85a-3149b5f8bbd2.png)
>
> ![img](https://api2.mubu.com/v3/document_image/25165450_9720e314-ee7d-407f-b9c5-bd1940aada40.png)

------

### `AuraEnemy` 上重写 `PossessedBy`

> ### 创建配置 `行为树` 和 `AIController` 的指针![img](https://api2.mubu.com/v3/document_image/25165450_af21efe5-a780-4a27-e5d5-b146d6f2bb8a.png)
>
> ### 重写PossessedBy
>
> ![img](https://api2.mubu.com/v3/document_image/25165450_ce07b319-3e2b-48d4-a3c9-e797e3105091.png)
>
> ### 被控制的时候就设置 AIController的指针为新的Controller![img](https://api2.mubu.com/v3/document_image/25165450_78762dde-7a38-430d-efe8-53fb7698e0e3.png)

------

### 创建 AuraAlController 蓝图继承类，命名为 BP_AuraAlController

>- 在 `Content/BP/AI/` 文件夹下，创建 `AuraAlController` 蓝图继承类，命名为 *BP_AuraAlController*
>
>![img](https://api2.mubu.com/v3/document_image/25165450_74a63cab-e1b9-4445-eaa1-02f5f4c2feda.png)
>
>

------

### 蓝图中敌人基类，配置 AIController类

> ![img](https://api2.mubu.com/v3/document_image/25165450_7bf3e8de-6066-44ef-d058-51d94c0ff691.png)

------

### 蓝图中创建黑板和行为树

> ### 在 Content/BP/AI/ 文件夹下
>
> ### 分别命名为：
>
> - #### 黑板 —— `BB_EnemyBlackboard`
>
> - #### 行为树 —— `BT_EnemyBehaviorTree`
>
> ![img](https://api2.mubu.com/v3/document_image/25165450_da4da682-db40-4942-a71b-aedbd6b0ee37.png)

------

### 敌人蓝图基类中配置黑板

> ![img](https://api2.mubu.com/v3/document_image/25165450_79f6df46-ced8-4d90-b2ee-50e0ed744955.png)

------

## 接下来需要运行行为树

------

## 需要注意的！！！只有服务器才能控制AI，客户看到的任何东西都是复制的结果

> ![img](https://api2.mubu.com/v3/document_image/25165450_cf8f40df-ffc0-405d-fe20-2f451193411a.png)

------

### C++中运行行为树，初始化黑板数据

>- #### 需要传入黑板数据：通过API：`行为树->BlackboardAsset` 获取
>
>![img](https://api2.mubu.com/v3/document_image/25165450_e5a15a5c-882e-44af-d121-6f2d23a8fef9.png)

------

### 接下来行为树上配置测试节点，测试一下

> ![img](https://api2.mubu.com/v3/document_image/25165450_32dabbb7-c8d6-454e-d654-be341b226f94.png)
>
> ![img](https://api2.mubu.com/v3/document_image/25165450_181511aa-95ea-4152-95d0-772ee1f2952d.png)

------

#### 下面是下一节

------

>## 下面需要让AI寻找玩家，需要一个自定义的任务

------

### 创建自定义的行为树任务节点服务 `UBTService_BlueprintBase` 类

>- ### 在 `Aura/Public/AI/` 文件夹下
>
>- ### 创建 `UBTService_BlueprintBase` 类，命名为： `BTService_FindNearestPlayer`

------

### 自定义的行为树任务节点中重写 TickNode 虚函数

> ![img](https://api2.mubu.com/v3/document_image/25165450_d11059c9-e0cb-498c-f6d4-245ce5e890f3.png)

### 看一下 `UBTService_BlueprintBase` 类源码

>- #### `AIOwner`
>
>- #### `ActorOwner`
>
>![img](https://api2.mubu.com/v3/document_image/25165450_f7d53749-b5a3-487d-da8b-eb079ecca700.png)

------

###  `TickNode` 虚函数中添加测试代码

> ![img](https://api2.mubu.com/v3/document_image/25165450_ca78bed6-30d1-4ce7-e591-2e418500b8ca.png)

------

### 创建自建行为树任务节点服务的蓝图继承类，命名为 BTS_FindNearestPlayer

>- ### 在 Aura/Public/AI/ 文件夹下
>
>![img](https://api2.mubu.com/v3/document_image/25165450_0f3e8605-5b54-427d-a6be-b6308cae4032.png)
>
>- #### 节点名称可以修改为 **FindNearestPlayer**

------

### 此时我们在行为树中使用呼出 自建行为树任务节点服务 可以看到 蓝图的 和 C++的 (这里使用的是蓝图版本)

>![img](https://api2.mubu.com/v3/document_image/25165450_2f17320d-5947-4682-8d98-1f26d90c42be.png)
>
>![img](https://api2.mubu.com/v3/document_image/25165450_39d441ea-3ac5-43d2-e1b5-43120201c42e.png)

------

### 测试一下 自建行为树任务节点服务 的Tick

>### 必须要蓝图中实现这个Tick函数，才会调用C++里面的逻辑![img](https://api2.mubu.com/v3/document_image/25165450_dade394f-04a9-42d5-d2da-c8d199a2cc5c.png)![img](https://api2.mubu.com/v3/document_image/25165450_4bf3ca49-33f1-41c1-fe71-af5470d866d1.png)
>
>#### 这样链接测试，蓝图和C++都会执行![img](https://api2.mubu.com/v3/document_image/25165450_e2f15acd-9fde-42c8-8825-9d5ad46237c7.png)![img](https://api2.mubu.com/v3/document_image/25165450_c06b1580-4d18-413e-90f2-9c73adfef0ef.png)
>
>#### 断开蓝图里的链接，运行时也会执行C++里面的逻辑![img](https://api2.mubu.com/v3/document_image/25165450_e9de26b7-8016-49a6-e11a-2cbe462b8a53.png)![img](https://api2.mubu.com/v3/document_image/25165450_10000ace-7f9d-4dca-ac3f-b1b0cc484af3.png)
>
>## 行为树的服务中，只要实现了Tick函数，就会执行C++里面的事件！！！！！


___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________