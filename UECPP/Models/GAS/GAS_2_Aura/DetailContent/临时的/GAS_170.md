___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 170 制作闪电链视觉效果，为目标配置Cue的Param，结束技能后移除

___________________________________________________________________________________________

## 处理关键点

1. 蓝图中使用TMap(无法遍历)
    - 想办法：还需要额外搞一个TArray

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[15. Shock Loop Cues on Additional Targets_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?spm_id_from=333.788.player.switch&vd_source=9e1e64122d802b4f7ab37bd325a89e6c&p=128)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

### 上一节我们找到并遍历了最近的角色（敌人），这一节，在受到影响的敌人身上生成Cue

#### 在设置完首个角色后，遍历
>![img](https://api2.mubu.com/v3/document_image/25165450_99694c30-4140-4aec-99a3-41daf5089d8b.png)


------

#### 释放技能时就可以看到
>![img](https://api2.mubu.com/v3/document_image/25165450_afc4d1fa-debc-481a-fd66-e8d8c8329702.png)


------

### 在这里批量处理Actor的一些逻辑
>![img](https://api2.mubu.com/v3/document_image/25165450_71a7fbbc-5d5a-4709-e41c-9a0ee5327c0e.png)


------

#### 创建函数

  - `AddShockLoopCueToAdditionalTarget`

>![img](https://api2.mubu.com/v3/document_image/25165450_d575b532-2b42-4523-a7e4-05d1be3d7f01.png)


------

#### 接下来需要一个<Actor*,CueParam>的映射表

  - 蓝图中创建变量
    - `AdditionalActorsToCueParams`

>![img](https://api2.mubu.com/v3/document_image/25165450_c2461eb9-02be-4dbc-de3f-a13733af04fb.png)


------

##### 添加元素，并为目标添加CueLoop
>![img](https://api2.mubu.com/v3/document_image/25165450_dce95a9c-e93a-46be-c055-8b56859320ec.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_25f8f9bd-f565-472f-e4e5-5f75be36b8c7.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_93b67d3e-3280-45a7-e54b-d55f27da1863.png)


------

#### 移除时，也需要根据TMap表来移除，但是蓝图并不支持遍历TMap
>![img](https://api2.mubu.com/v3/document_image/25165450_835e3587-36b9-492f-a577-b565c9c7e14a.png)


------

##### 所以创建数组遍历,移除目标的CueLoop

  - `AdditionalTargets`

>![img](https://api2.mubu.com/v3/document_image/25165450_f40110e7-7c91-4968-9fd3-c02f9fc0fe47.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_b959ca3a-052e-43f4-8b6c-b5e857c2664f.png)


------

###### 折叠为函数

  - `RemoveShockLoopCueFromAdditionalTarget`

>![img](https://api2.mubu.com/v3/document_image/25165450_dafdabc1-87f7-465f-f4ea-f23b5e771974.png)


------

###### 使用临时变量记录
>![img](https://api2.mubu.com/v3/document_image/25165450_dd947c16-855f-4e4e-b943-75b77d6c3058.png)


------

#### 生成时，遍历添加CueLoop
>![img](https://api2.mubu.com/v3/document_image/25165450_7c383830-89dc-4c9c-eb14-f0585c26d87a.png)


------

### 运行测试gif
>![img](https://api2.mubu.com/v3/document_image/25165450_56a7ee97-edea-48c4-836f-634dcdc0d5b9.png)


------

### 有一个bug，点击地面释放技能时，因为射线被敌人挡住，会触发闪电链，但是因为点击地面，没有实现接口，所以导致bool为false，取消技能时，没有移除对象身上的cueLoop
>![img](https://api2.mubu.com/v3/document_image/25165450_642ab637-ece1-47d0-bd27-e5ff81bf24bb.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_d52c92ef-7038-48b5-f64c-a7e2225dd798.png)


------

#### 所以，链式反应时，需要检查是否实现了接口，如果没有，不会触发连锁反应
>![img](https://api2.mubu.com/v3/document_image/25165450_73bb1f08-f07d-4ae2-ff75-09ca7359a090.png)


------

#### 在运行测试就正常了gif
>![img](https://api2.mubu.com/v3/document_image/25165450_f8ce3d35-85ea-4afc-a294-4a90febf606d.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_168608c3-3bb6-4660-ea1a-c04b1ad160cb.png)


------

### 下一节开始处理扣血的逻辑


___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________