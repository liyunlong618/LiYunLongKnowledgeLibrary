___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 169 处理闪电技能链式伤害的后续添加目标逻辑，获取首个目标附近最近的N个单位

___________________________________________________________________________________________

## 处理关键点

1. 使用 `TNumericLimits<double>::Max();` 获取无穷大的变量

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[14. Additional Targets_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?spm_id_from=333.788.player.switch&vd_source=9e1e64122d802b4f7ab37bd325a89e6c&p=127)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

### 上一节，我们处理了，击中第一个目标之后处理的关于这个目标的逻辑，这一节我们需要根据这个目标的位置（或者传入的位置）获取目标地点的所有对象，切根据距离，筛选最近的N（和技能等级相关）个对象

  - 因为计算比较复杂这部分逻辑放在cpp中，通过蓝图调用节点，节省了开销


------

#### 创建获取目标范围内多个对象的函数

  - `StoreAdditionalTargets`

>![img](https://api2.mubu.com/v3/document_image/25165450_a377737b-71f6-4db2-ff92-206a1dcb32b5.png)


------

##### 我们之前在蓝图函数库创建过一个类似的功能
>![img](https://api2.mubu.com/v3/document_image/25165450_c5be22e6-1d46-47bb-b393-43d5be18568c.png)


------

#### 我们还需要像火球技能的 `生成火球最大数量` 一样，搞一个闪电技能的 `最大链接目标数量`

  - `MaxNumShockTargets`

>![img](https://api2.mubu.com/v3/document_image/25165450_ae09b926-59be-4eb6-9e43-2c0849ca31af.png)


------

#### `StoreAdditionalTargets` 函数体中，可以拿到目标地点为半径的圆中的角色
>![img](https://api2.mubu.com/v3/document_image/25165450_79104bc6-cf9d-46fb-b004-c5506560d3e8.png)


------

#### 但是现在还需要根据距离拿到最近的 `N` 个角色

  - 需要在蓝图函数库中创建对应函数


------

##### `创建根据TArray<Actor*>，返回最近的N个角色` 的函数

  - `GetClosestTargets`

  - 需要几个参数

    - 最大数量

    - 所有角色的数组

    - 输出的数组

    - 计算原点位置

>![img](https://api2.mubu.com/v3/document_image/25165450_3208b847-b505-4032-d859-ff86db89db7b.png)


------

#### `GetClosestTargets` 函数体内，添加

  - 逐个添加最近的Actor

  - 使用 `TNumericLimits<double>::Max();` 获取无穷大的变量

>![img](https://api2.mubu.com/v3/document_image/25165450_e5656230-0485-4f2f-a6c9-1d050878b34b.png)


------

#### `StoreAdditionalTargets` 函数中调用，获取最近的几个Actor*的数组
>![img](https://api2.mubu.com/v3/document_image/25165450_2ddbbc56-4431-42a4-eedf-3e7f968ba5b4.png)


------

#### 蓝图中调用，生成debug测试
>![img](https://api2.mubu.com/v3/document_image/25165450_ee3760b9-192f-4c81-f13c-c3890a96840c.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_f547230a-b0fc-4557-bfaa-8b8c10b277d1.png)


------

##### 场景中多摆放几个敌人
>![img](https://api2.mubu.com/v3/document_image/25165450_bb578fc8-7a9b-48eb-8b42-1e124ec8a22e.png)


------

##### 测试结果gif
>![img](https://api2.mubu.com/v3/document_image/25165450_52da9033-8623-4a89-f450-cc8f83343286.png)


------

##### 在结束循环后debug整个技能范围
>![img](https://api2.mubu.com/v3/document_image/25165450_56702c19-5985-41a6-981b-924bcf66bb03.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_5922ba39-8520-4311-900e-72eb045c18a8.png)


___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________