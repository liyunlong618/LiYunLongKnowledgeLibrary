___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 147 处理装备技能广播技能新位置后，其他技能球贴图材质清空的bug；同步装备技能InputTag变化到主UI(WBP_Overlay)；装备技能后取消选择

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[31. Updating the Overlay When Equipping Abilities_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP/?p=98&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

[32. Globe Reassigned_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP/?p=99&spm_id_from=pageDriver&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________


### 现在有一个bug，当我们装备一个 技能 到 `插槽` 上时，会清除所有技能的图标

  - 原因是：我们原来检查只要是None就调用恢复图标的函数，但是需要判断是否与输入Tag匹配

>![img](https://api2.mubu.com/v3/document_image/25165450_3894f4c9-d381-408e-86cc-847a43ff2eb3.png)


------

#### 修改一下，先判断是否匹配 `输入Tag` ，再判断是否为 `None`

>![img](https://api2.mubu.com/v3/document_image/25165450_c8772d0f-3325-48a7-8a9b-c7519778af96.png)


------

### 运行测试，这次正常了

>![img](https://api2.mubu.com/v3/document_image/25165450_7e907b24-4072-479f-dc27-7d010c902789.png)


------

#### 当我们按下闪电对应的 `InputTag` 后 会触发技能

>![img](https://api2.mubu.com/v3/document_image/25165450_03b2fd62-529f-4c95-fac2-4b5e3b8d026f.png)


------

### 测试一下gif：技能可以随意切换，还可以互相覆盖，且可以使用对应输入按键触发技能

>![img](https://api2.mubu.com/v3/document_image/25165450_1fdac17b-0040-4f5f-cd17-c217864f150f.png)


------

### 下面就需要更新 ***WBP_Overlay*** 的逻辑了


------

#### 这里是我们之前在 `SpellMenuWidgetController` 中制作的主要逻辑，在回调中

>![img](https://api2.mubu.com/v3/document_image/25165450_d4aceff7-e392-4b69-a429-8a87f3bb6149.png)

- **需要在 `OverlayWidgetController` 中做同样的操作**


------

### 在 `OverlayWidgetController` 中，也创建一个回调

>![img](https://api2.mubu.com/v3/document_image/25165450_850ade4d-c4dc-4f30-f5d0-b6f885d4d426.png)


------

### 绑定回调

>![img](https://api2.mubu.com/v3/document_image/25165450_2dfdadf7-8376-4c29-c9d7-504204b547f0.png)


------

### 拷贝 `SpellMenuWidgetController` 回调函数中的逻辑，移除不用的逻辑

>![img](https://api2.mubu.com/v3/document_image/25165450_1e762ab6-6924-449a-829b-1f5bd5331e57.png)


------

### 运行测试gif：虽然我们可以监听同步消息，但是也遇到了之前的问题

>![img](https://api2.mubu.com/v3/document_image/25165450_5d845c48-4a1f-4c97-8d09-f9d47738e849.png)


------

#### 还是同样的问题，在匹配 `InputTag` 后检查图标的技能标签是否匹配 `None` ，如果是，自己 设置 默认贴图纹理

>![img](https://api2.mubu.com/v3/document_image/25165450_fd8103e9-86d8-4cd5-c044-8b2a978e960c.png)


------

### 此时运行测试gif有一个bug：当我们先装备火球到右键上，再释放技能时，左键的位置贴图就会变成白色

  - 看着好像与技能CD有关

>![img](https://api2.mubu.com/v3/document_image/25165450_a08d3b1e-1c05-4ac0-d3d5-0048b9c03b51.png)


------

#### 在技能CD时，没有清空对应的 `CooldownTag` ，导致它还会 `接收CD的广播` ，所以手动设置默认时，需要清空一下

>![img](https://api2.mubu.com/v3/document_image/25165450_b40283bf-0e41-4bbb-998c-0e6b2d74902a.png)


------

### 在测试就正常了gif

>![img](https://api2.mubu.com/v3/document_image/25165450_ad4440a8-f071-4047-ca65-4c9ac270945f.png)


------

### 下一节我们将处理：当我们装备技能后，取消选择该技能，然后为装备技能，播放音效


------

### 思路是，创建一个委托，广播技能标签，因为每个技能球都只知道自己的标签

>![img](https://api2.mubu.com/v3/document_image/25165450_356a4340-9544-4eb1-c252-11510a709139.png)


------

#### 创建动态多播，广播一个参数，再声明一个委托

  - 命名为，`FSpellGlobeReassignedSignature`

  - 委托命名为，`FSpellGlobeReassignedDelegate`

>![img](https://api2.mubu.com/v3/document_image/25165450_baac4d75-f72a-46cd-a2fd-85144525101d.png)

>![img](https://api2.mubu.com/v3/document_image/25165450_244c880d-f0b8-4054-b1f9-428a5a2f83eb.png)


------

#### 在执行完 `点击装备技能区插槽` 的回调 `OnAbilityEquipped` 后，广播动态委托

>![img](https://api2.mubu.com/v3/document_image/25165450_99bcca7f-53f5-4251-99ea-bc0f32d653ae.png)


------

#### 然后手动调用 BlueprintCallable 取消选择的函数 `GlobeDeselect`

>![img](https://api2.mubu.com/v3/document_image/25165450_c92a1c1c-e37e-4c40-d079-3ab02a07c7a2.png)


------

#### 蓝图创建整合的回调函数

  - 命名为，`OnSpellGlobeReassigned`

>![img](https://api2.mubu.com/v3/document_image/25165450_65126661-95c7-4e89-99fc-ac8ff12dfc12.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_55f9c32d-8587-41b7-d487-749fd5cfc68b.png)


------

#### 音频资产路径

>![img](https://api2.mubu.com/v3/document_image/25165450_656f6382-dc2b-4942-97e8-cee17694fba3.png)


------

### 这个时候有个bug：当我们装备一个技能后，如果还选择同一个技能，会听到取消选择的音效

>![img](https://api2.mubu.com/v3/document_image/25165450_ab7b205e-b071-45da-fe0b-7b7640d87302.png)

- 因为，之前的bool还没重置，也需要重置下

>![img](https://api2.mubu.com/v3/document_image/25165450_51bbc0fe-0f10-4bc8-cbee-35662db257f0.png)


------

### 此时运行测试gif

>![img](https://api2.mubu.com/v3/document_image/25165450_4d21fb0b-e366-44b8-c467-d179c2cb46ba.png)


___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________