<details>
<summary>过程截图</summary>

>

------

</details>




+ `头文件`中：
```cpp
这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码这里是头文件代码
```

+ `源文件`中：
```cpp
这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码这里是源文件代码
```

[Mermaid格式参考](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/Mermaid%E6%A0%BC%E5%BC%8F%E5%8F%82%E8%80%83.md)

[预览](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/tree/main/UECPP/Models/GAS/GAS_2_Aura)



___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 155 自建 NS组件 监听 DebuffTag
________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[9. Debuff Niagara Component_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP/?p=109&vd_source=9e1e64122d802b4f7ab37bd325a89e6c)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

#### 创建自建C++类继承自 `NiagaraComponent`
  - 命名为，`DebuffNiagaraComponent`
>![img](https://api2.mubu.com/v3/document_image/25165450_849e69e9-ca50-4f25-93bd-1990b6f75826.png)

------

#### 构造中关闭自动激活NS，持有当前的 `DebuffTag`
>![img](https://api2.mubu.com/v3/document_image/25165450_e728b6ec-5505-4570-fb2e-42760976c5da.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_cbd5407c-56b4-4046-e140-7165a60e1afe.png)

------

### 小测试1

  - 当激活 `DebuffTag` 时，激活NS特效

  - 当 `DebuffTag` 被移除时，关闭NS特效
>![img](https://api2.mubu.com/v3/document_image/25165450_68e5cb86-51d4-4ea7-b5e7-f9af14094c2b.png)

------

### 自己尝试一下


------

#### 重写BeginPlay
>![img](https://api2.mubu.com/v3/document_image/25165450_0d7ecb4b-d889-41e7-9e9d-05f7ebf3c565.png)

------

#### 重写监听 `FGameplayTag` 变化 的回调函数

  - 命名为，`DebuffTagChanged`
>![img](https://api2.mubu.com/v3/document_image/25165450_39388059-e7ed-4d2d-d16c-60d2e07d5775.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_0def43a6-0c0d-44f0-b990-5bc888b8360f.png)

------

#### `BeginPlay` 时监听 `Tag变化`
>![img](https://api2.mubu.com/v3/document_image/25165450_314d6b93-a73c-4951-ad8b-4390138fa48a.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_23b57c16-9f7f-4ec1-e70f-ee1a32645366.png)

------

### 现在有一个问题，当我们绑定监听Tag变化的回调时，可能ASC还没初始化完成，所以需要处理这个问题

  - 可以在ASC上创建广播来处理，但是这样就会使这个DebuffNS组件和ASC组件相绑定
    - 打算使用接口来做


------

#### 在 `ICombatInterface` 接口中，创建广播

  - 命名为，`FOnASCRegistered`

  - 广播一个参数：ASC组件的指针
>![img](https://api2.mubu.com/v3/document_image/25165450_ffcbae8b-4557-411d-997d-423c1ea34d0a.png)

------

#### 接口中创建纯虚函数，返回委托（让目标必须实现这个委托）

  - 命名为，`GetOnASCRegisteredDelegate`
>![img](https://api2.mubu.com/v3/document_image/25165450_c4d680fe-27fc-4791-9adf-0bc854cb6ffa.png)

------

#### 角色基类中创建委托，重写纯虚函数 `GetOnASCRegisteredDelegate`
>![img](https://api2.mubu.com/v3/document_image/25165450_e1279559-049e-4c62-96ea-0bd090a8d618.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_98c0ce80-957a-40e8-c4e8-083fe8c77287.png)

------

#### 在 `DebuffNiagaracomponent` 中，如果目标的ASC为空，且实现了 `ICombatInterface` 接口，`AddWeakLambda` ，使用实参的ASC组件绑定回调
>![img](https://api2.mubu.com/v3/document_image/25165450_36f6467b-98a1-4696-eff6-034af531ea80.png)

------

##### `AddWeakLambda`与`AddLambda` 区别

  - 当捕获列表中捕获对象时，不增加引用计数，当组件没有引用时，会GC

  - 使用时需要传入对象
>![img](https://api2.mubu.com/v3/document_image/25165450_c0bf1679-05d4-4da2-a68f-9f6e72660492.png)

------

#### 接下来需要在ASC组件初始化完成时，广播自身


------

##### Player中
>![img](https://api2.mubu.com/v3/document_image/25165450_581dcb90-4fd2-4915-9544-77c52af9b023.png)

------

##### 敌人中
>![img](https://api2.mubu.com/v3/document_image/25165450_4bdf63f6-97d7-4249-df19-ce6cdc00de47.png)

------

### 接下来还有一种情况，当敌人死亡时，也需要广播停止NS特效


------

### 因为接下来，可能会有一些逻辑，都需要在对象死亡时触发，所以在 `ICombatInterface` 接口中创建角色死亡时广播的动态多播，携带一个参数：当前死亡的对象 `AActor*`

  - 命名为，`FOnDeath`
>![img](https://api2.mubu.com/v3/document_image/25165450_0d68b4c4-63c7-4698-f38c-e9a68ecf87f4.png)

------

### 在 `ICombatInterface` 接口中创建获取委托的纯虚函数
>![img](https://api2.mubu.com/v3/document_image/25165450_075c6f37-f652-49e9-c47a-895c39e23c47.png)

------

### 角色基类中，创建委托，重写纯虚函数
>![img](https://api2.mubu.com/v3/document_image/25165450_1560ab82-8914-483d-b58f-7d06a31cc4be.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_e1998cce-9b4d-476d-8736-f33852c9b8c2.png)

------

### 自建NS组件中，创建死亡时的回调函数
>![img](https://api2.mubu.com/v3/document_image/25165450_4431e7f2-b737-4ef4-fc92-5b787077e21c.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_e699c5c5-eb17-43c0-b9a1-ec5f0da8f763.png)

------

### 绑定回调
>![img](https://api2.mubu.com/v3/document_image/25165450_cd1239c7-4867-46fc-b05a-dc25899a2044.png)

------

### 接下来需要在死亡时广播


------

#### 我们之前在RPC_Client函数中处理了死亡的逻辑
>![img](https://api2.mubu.com/v3/document_image/25165450_b3edcf4a-9c09-4588-d107-e0caf404c839.png)

------

#### 现在需要在这里 广播死亡时的动态多播 `FOnDeath`
>![img](https://api2.mubu.com/v3/document_image/25165450_95d7a9c3-a37a-409c-ca41-31ab059c08d7.png)

------

### 接下来，需要在角色基类中创建 `自建NS组件`
>![img](https://api2.mubu.com/v3/document_image/25165450_ed7f26cf-485c-466c-aaf6-b47694b850e8.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_35391d0c-9af0-48fc-d287-55e5f51bb2f3.png)

------

### 蓝图中配置，和调整位置
>![img](https://api2.mubu.com/v3/document_image/25165450_62e6b241-b660-4ba4-c2a5-49ed846a5f57.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_2e320cf7-25a2-4a05-f496-b05126c3a2db.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_8a22a494-0ffc-43a9-e4c2-0da6c372638f.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_0fb04cc3-7c36-4f2d-88e2-403843f97270.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_6d7bdc64-cd5c-41d0-feff-ebc21761cad2.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_c459b6a9-e8df-4750-960e-81d13b36e0f4.png)

------

### 运行测试gif
>![img](https://api2.mubu.com/v3/document_image/25165450_53bbae44-f4cd-4bd7-887a-0aa04e6bc006.png)

------

### 重设闪电GA的父类，这样就可以看到继承的参数
>![img](https://api2.mubu.com/v3/document_image/25165450_14081d78-76f0-479e-9e42-f07799545bfa.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_dbc548ca-5127-4356-fafb-96ad6837ba45.png)
___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________