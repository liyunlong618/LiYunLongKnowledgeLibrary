___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 171 使用Timer为闪电链制作掉血逻辑，并在首个目标死亡后结束技能

___________________________________________________________________________________________

## 处理关键点

1. 使用计时器做持续伤害处理

___________________________________________________________________________________________

# 目录


[TOC]


___________________________________________________________________________________________

<details>
<summary>视频链接</summary>

[16. Electrocute Cost Cooldown and Damage_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?spm_id_from=333.788.player.switch&vd_source=9e1e64122d802b4f7ab37bd325a89e6c&p=129)

[17. Applying Electrocute Cost and Damage_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1TH4y1L7NP?spm_id_from=333.788.player.switch&vd_source=9e1e64122d802b4f7ab37bd325a89e6c&p=130)

------

</details>

___________________________________________________________________________________________

### Mermaid整体思路梳理

Mermaid

___________________________________________________________________________________________

### 现在我们需要让技能有伤害，需要配置

  - `DamageEffectClass`

  - 伤害曲线

  - 配置 触发Debuff 和 击飞 概率

  - 创建CD和Cost，并配置


------

#### `DamageEffectClass`
>![img](https://api2.mubu.com/v3/document_image/25165450_ee0d08cc-accd-447c-fb89-f3c8c66cf1f7.png)


------

#### 伤害曲线
>![img](https://api2.mubu.com/v3/document_image/25165450_6eea4eff-96e1-46de-abb8-4f28b6fe0206.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_bc83834d-7625-4bfa-b2da-90cffce4974f.png)

- 伤害值比较低是因为这是个每0.1s触发一次的伤害，频率比较高


------

#### 先暂时不触发Debuff，并且因为是持续类技能，不想让目标被击飞
>![img](https://api2.mubu.com/v3/document_image/25165450_0a28efc0-7134-4c18-9cc0-bbb3bb49b715.png)


------

#### 接下来，创建CD和Cost，并配置

  - Cost
>![img](https://api2.mubu.com/v3/document_image/25165450_93f4af23-4f45-4f69-d540-876f684967aa.png)

  - 还缺少曲线
>![img](https://api2.mubu.com/v3/document_image/25165450_3a6b1f43-2bcd-4469-ab10-cbd9112e3136.png)

  - CD
>![img](https://api2.mubu.com/v3/document_image/25165450_ea678bcd-1f50-4e00-9f54-3b375e84d4f6.png)

  - CD还需要配置一个CD的Tag（5.3这里有变动）
>![img](https://api2.mubu.com/v3/document_image/25165450_af16dfd2-b3e0-4e96-c03e-66cba7cd9aab.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_c7525aa1-bd4b-4e56-f450-1dfb23ced20b.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_22292fd4-0679-4378-c478-a24aacb6310e.png)

  - 配置
>![img](https://api2.mubu.com/v3/document_image/25165450_8d6c0399-3a1f-4ccb-d0fd-3c199366f163.png)


------

### 现在还没有伤害，下一节，处理循环伤害


------

### 使用计时器做伤害处理，和MP扣除


------

### 创建参数，多久扣除一次MP

  - `DamageDeltaTime`

  - 先使用0.1
>![img](https://api2.mubu.com/v3/document_image/25165450_6e46039e-5358-4651-eac3-e6cc5f554c81.png)


------

#### 计时器
>![img](https://api2.mubu.com/v3/document_image/25165450_2ff066f8-8ca6-4a17-9224-0ce53cb6ea9e.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_edc812e3-96db-4d2d-d072-b93c24373e82.png)
>![img](https://api2.mubu.com/v3/document_image/25165450_8d8d2b87-a679-4fe2-a821-941ea8be3da9.png)


------

#### 运行测试gif可以掉MP了
>![img](https://api2.mubu.com/v3/document_image/25165450_c1b39b06-7ea6-4664-f801-448a3ac270f1.png)


------

#### 可以扣除消耗时，应用伤害


------

##### 创建函数

  - `ApplyDamage`

>![img](https://api2.mubu.com/v3/document_image/25165450_7ee3e12c-5183-48a2-a82a-7474e4fa3f04.png)


------

##### 使用Spec绑定SetBuCaller
>![img](https://api2.mubu.com/v3/document_image/25165450_db4b18b1-382c-45fb-c98d-1236991a58a0.png)


------

##### 需要使用Damage，但是没有对应的函数，需要创建一个
>![img](https://api2.mubu.com/v3/document_image/25165450_ad6b30c1-f440-4d7a-d645-66df4302d0a9.png)


------

###### 创建函数

  - `GetDamageAtLevel`

>![img](https://api2.mubu.com/v3/document_image/25165450_844598e7-bf66-451a-d728-ecaf4174a893.png)

  - 其实就是之前这里的逻辑
>![img](https://api2.mubu.com/v3/document_image/25165450_d77954c8-a143-4c92-8ac6-aeba0074a7f9.png)

>![img](https://api2.mubu.com/v3/document_image/25165450_4e048614-b127-4395-bc27-bfa21beba339.png)


------

#### 最后应用GE
>![img](https://api2.mubu.com/v3/document_image/25165450_5a346c66-d277-440b-a0cb-5736cb70e947.png)


------

#### 整合成一个函数

  - `ApplyDamageSingleTarget`

>![img](https://api2.mubu.com/v3/document_image/25165450_3994eb23-8fbb-4fb3-d43f-baa84cd0241f.png)


------

#### 遍历 调用
>![img](https://api2.mubu.com/v3/document_image/25165450_e854d251-e38d-4a65-a3b6-c8557a3d7283.png)


------

#### 可以扣除消耗时调用
>![img](https://api2.mubu.com/v3/document_image/25165450_5eff46c7-c95b-4b18-cc4b-de8cf17c07db.png)


------

### 但是现在会无限调用，所以需要创建bool记录敌人是否死亡，死亡则技能停止

  - `TargetDead`

>![img](https://api2.mubu.com/v3/document_image/25165450_18b05de4-16b8-4c39-ad27-033a2f1389c9.png)

>![img](https://api2.mubu.com/v3/document_image/25165450_e564977b-c112-47b7-c9e9-66eb5f451435.png)


------

#### 死亡时停止需要结束技能，结束这部分也需要整合成一个函数

  - ClearTimerAndEndAbility

>![img](https://api2.mubu.com/v3/document_image/25165450_331188de-93a2-4a78-edb6-415125b65e22.png)

>![img](https://api2.mubu.com/v3/document_image/25165450_3397bcc8-6b36-40d5-82cf-abb18b1985f2.png)


------

### 运行测试gif
>![img](https://api2.mubu.com/v3/document_image/25165450_60a87493-0e9d-4aa4-df97-86535beb93bf.png)


------

#### 有一个问题，敌人死亡后没有断开连接
>![img](https://api2.mubu.com/v3/document_image/25165450_9de8bfae-168c-4f50-f725-20a38e063a48.png)


------

### 下一节，处理


___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________