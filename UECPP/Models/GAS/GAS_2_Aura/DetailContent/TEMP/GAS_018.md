___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 3.8 MMC——Modifier Magnitude calculation(自定义属性计算方式);以及如何使用自定义后的值初始化HP/MP属性
___________________________________________________________________________________________
## 处理关键点
1. 自定义属性计算方式需要创建类`GameplayModMagnitudecalculation`
   - //步骤一:需要依赖的属性 要创建`FGameplayEffectAttributecaptureDefinition`类变量 构造中，给变量配置参数
   - //步骤二:重写虚函数`CalculateBaseMagnitude`并调用核心处理API`GetCapturedAttributeMagnitude`为变量赋值，然后通过`FGameplayEffectSpec`拿到角色数据，计算并返回
   - //步骤三:GE中配置自定义计算方式
___________________________________________________________________________________________

[TOC]

___________________________________________________________________________________________


### 下一步任务

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/783593_966830.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/61766_180318.png?raw=true)
### 创建 GameplayModMagnitudeCalculation 类C++文件（_ 游戏修正幅度计算）又叫MMC

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/918871_880172.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/779229_219152.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/886762_90298.png?raw=true)
### UMMC_MaxHealth 中创建构造，重写 `CalculateBaseMagnitude` 虚函数，并创建一个 `FGameplayEffectAttributeCaptureDefinition` 类型的变量（这个类型是一个集合信息的结构体）

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/415115_796974.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/535795_916183.png?raw=true)
### 修改 **GE_AuraSecondaryAttributes** 次要属性中的MaxHP的计算方式

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/329204_263916.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/845159_788059.png?raw=true)
### 这里处理之前的遗漏
#### 1.Source为空，因为 AAuraCharacterBase 中初始化属性(应用GE)时并没有指定Source

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/273965_855642.png?raw=true)
#### 2.PS中Level没有给默认为1所以初始等级为0

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/21499_80346.png?raw=true)
### 测试结果
#### 所以MaxHP=80+9*1*15=215 

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/951979_960659.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/753239_698218.png?raw=true)
### 小测试:使用自定义属性计算方式法力最大值 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/264761_928466.png?raw=true)
#### 自己尝试一下

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/350456_377917.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/816069_587295.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/221407_939573.png?raw=true)
### 测试结果
#### 所以MaxMP=90+17*1*25=515 

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/513529_21156.png?raw=true)
#### 当然我这个数值设定不一定合理，这个随意 

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/371823_625409.png?raw=true)
### 使用自定义后的值初始化HP/MP属性
#### 不用在 UAuraAttributeSet 构造中初始化HP/MP了

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/725722_545360.png?raw=true)
### 小测试:初始化HP/MP使用最大值， 提示:使用GE 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/200484_902910.png?raw=true)
#### 自己尝试一下

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/439807_232906.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/246098_838931.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/679826_404457.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_018/99329_535508.png?raw=true)

___________________________________________________________________________________________

[返回最上面](#Go主菜单)
___________________________________________________________________________________________