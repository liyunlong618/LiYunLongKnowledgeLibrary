___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 5.8 使用自定义AbilityTasks
___________________________________________________________________________________________
## 处理关键点
1. UFUNCTION宏的一些用法

  - `UFUNCTION( meta = ( DisplayName = "TargetDataUnderMouse" ))`             设置在蓝图编辑器中显示的函数名称

  - `UFUNCTION( meta = ( Tooltip = "This is my custom function tooltip" ))`   在蓝图编辑器中显示的提示信息，当鼠标悬停在函数或属性上时显示。

  - `UFUNCTION( meta = ( HidePin="OwningAbility" ))`                          隐藏特定的输入引脚（Pin）

  - `UFUNCTION( meta = ( DefaultToSelf="OwningAbility" )) `                   设置默认值。如果某个引脚没有被连接，蓝图将其值设置 为 self

  - `UFUNCTION( meta = ( BlueprintInternalUseOnly = "true" ))`                蓝图中仅限内部使用 宏

  - `UFUNCTION( meta = ( DevelopmentOnly ))`                                  仅在开发版本中可见，发布版本中隐藏。

2. `UAbilityTask`
  - 在蓝图中调用 `UAbilityTask` 的方法会被视为异步的，这是因为 `UAbilityTask` 类的设计本身就是为了处理`异步任务`。虽然在 C++ 代码中执行逻辑可能是同步的，但 `UAbilityTask` 的机制允许在蓝图中以异步方式使用它们。
  - 
___________________________________________________________________________________________

[TOC]

___________________________________________________________________________________________


### 视频链接

  - 【【AI中字】虚幻5C++教程使用GAS制作RPG游戏（一）-哔哩哔哩】 https://b23.tv/PRDsFB6

### 此时希望创建一个，触发GA时为我们获取数据的AbilityTask(比如获取鼠标点击时射线检测结果)

### 创建AbilityTask的C++类，取名TargetDataUnderMouse，保存鼠标点击时的射线检测结果数据

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/01.png?raw=true)
   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/02.png?raw=true)

### UTargetDataUnderMouse中参考 蓝图的PlayMontageAndWait和WaitGameplayEvent，也创建一个 异步 的蓝图节点

  - 首先内部有一个静态函数，调用时创建一个自身的实例并返回

     
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/03.png?raw=true)

      

      - 宏的分别解释:

        - meta=() 括号内包含的是一些元数据参数

          - UFUNCTION( meta = ( DisplayName = "TargetDataUnderMouse" ))          设置在蓝图编辑器中显示的函数名称

          - UFUNCTION( meta = ( Tooltip = "This is my custom function tooltip" ))   在蓝图编辑器中显示的提示信息，当鼠标悬停在函数或属性上时显示。

          - UFUNCTION( meta = ( HidePin="OwningAbility" ))                    隐藏特定的输入引脚（Pin）

          - UFUNCTION( meta = ( DefaultToSelf="OwningAbility" ))                   设置默认值。如果某个引脚没有被连接，蓝图将其值设置 为 self

          - UFUNCTION( meta = ( BlueprintInternalUseOnly = "true" ))                蓝图中仅限内部使用 宏

          - UFUNCTION( meta = ( DevelopmentOnly ))                          仅在开发版本中可见，发布版本中隐藏。

    - 创建一个蓝图中可叫函数叫CreateTargetDataUnderMouse，分组"Ability|Tasks"，蓝图中命名为TargetDataUnderMouse，有一个参数UGameplayAbility* OwningAbility，蓝图中默参为self，对蓝图隐藏参数，蓝图中仅限内部使用 宏

     
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/04.png?raw=true)

    - 此时测试
     
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/05.png?raw=true)

### 输出引脚均为多播委托

     
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/06.png?raw=true)

    - 此时，输出引脚的这个不会执行，原因是没有广播该委托，也就不会收到信息
     
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/07.png?raw=true)

### 此时，需要重写父类中的虚函数Activate

     
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/08.png?raw=true)

      

      - 参考基类文件

        - 在基类的这里

          ![img](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/09.png?raw=true)

          - 基类源文件中也只写了一个UElog
           
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/10.png?raw=true)

    - 不用调用父类，因为父类啥也没写

      ![img](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/11.png?raw=true)

      - 参考基类文件

        - 在基类的这里

          ![img](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/12.png?raw=true)

          - 基类源文件中也只写了一个UElog
           
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/13.png?raw=true)

### 小测试

  ![img](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/14.jpg?raw=true)

  ![img](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/15.jpg?raw=true)

  ![img](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/16.jpg?raw=true)

  ![img](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/17.jpg?raw=true)

  ![img](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/18.jpg?raw=true)

  ![img](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/19.jpg?raw=true)

  ![img](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/20.jpg?raw=true)
  - 

     
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/21.png?raw=true)

     
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/22.png?raw=true)

    - 此时结果
     
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/23.png?raw=true)

### 有一个bug就是只有本地可以收到，客户端本地没有问题，但是服务器上，位置是0,0,0点

     
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_038/24.jpg?raw=true)

### 下节课处理这个问题

___________________________________________________________________________________________

[返回最上面](#Go主菜单)
___________________________________________________________________________________________