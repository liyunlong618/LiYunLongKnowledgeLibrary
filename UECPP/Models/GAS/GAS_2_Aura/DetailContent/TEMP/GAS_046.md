___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 6.6 为火球添加GE；敌人设置和初始化AttributeSet；处理碰撞bug
___________________________________________________________________________________________
## 处理关键点
1. 火球携带的不是GE而是`FGameplayEffectSpecHandle`,方便直接使用
2. 重温`初始化AttributeSet`的流程
___________________________________________________________________________________________

[TOC]

___________________________________________________________________________________________


### 视频链接

  - ![视频链接](https://b23.tv/rjgs6gR)

### 蓝图中创建一个GameplayEffect类

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/01.png?raw=true)

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/02.png?raw=true)

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/03.png?raw=true)

### 想要 抛射物-火球 携带一个FGameplayEffectSpecHandle游戏效果规格手柄。
 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/04.jpg?raw=true)

### 在抛射物火球中保存一个FGameplayEffectSpecHandle变量,设置为生成时公开,public 方便外部访问和调用

  - 

    

    - 如果报错,记得引头文件
     
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/05.png?raw=true)

### 抛射物的GA中声明可以在蓝图中配置GE的变量

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/06.png?raw=true)

### UAuraProjectileSpell中SpawnProjectile生成火球的函数中,生成火球前,获取角色AvatarActor的ASC组件,生成FGameplayEffectSpecHandle给火球的实例SpecHandle赋值

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/07.png?raw=true)

### Overlap时权威端销毁前需要检查目标是否有ASC组件,然后使用FGameplayEffectSpecHandle应用伤害

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/08.png?raw=true)

### 在AS组件中,当属性发生变化时,UE_Log下

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/09.png?raw=true)

### 这之前并没有为敌人初始化属性
 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/10.jpg?raw=true)

### 为敌人初始化属性

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/11.png?raw=true)

### BP_EnemyBase为敌人的基类 赋值

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/12.png?raw=true)

### GA_FireBolt中配置要应用伤害的GE

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/13.png?raw=true)

### 使用技能结束后,调用EndAbility

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/14.jpg?raw=true)

  - 我是这么干的
   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/15.png?raw=true)

### 此时测试UE_Log打印敌人血量

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/16.jpg?raw=true)

### 现在有bug,敌人不会初始化属性,主要属性正常,次要属性不对,原因是,敌人基类中,这个函数调错了
 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/17.png?raw=true)

### 这里之前有个bug,就是上一节在设置碰撞的问题,因为设置Mesh也检测,Capsule也检测,会触发两次检测,会有异常,解决办法是：设置Capsule关闭碰撞检测

  
   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/18.jpg?raw=true)


  - C++中设置Capsule关闭碰撞检测
   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/19.png?raw=true)

### 此时LS模式的gif,客户端和服务器可以合作打怪了

  

   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/20.gif?raw=true)


   
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_046/21.png?raw=true)

___________________________________________________________________________________________

[返回最上面](#Go主菜单)
___________________________________________________________________________________________