___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 4.3 重点！！！(委托绑定/变参函数模板)属性面板UI中绑定委托更新消息
___________________________________________________________________________________________
## 处理关键点
1. 属性菜单发送多播,单独属性的ItemWidgetUI接收，验证tag一致后更新自身信息（使用MachesTag验证）
2. 使用TMap把类型变量与静态函数的函数指针进行绑定
   - 
3. 函数指针格式`返回值类型（*指针名称）（参数类型）`
4. 函数指针使用时格式：`函数指针名();`即可调用
5. 通过ASC组件获取 当属性变化时广播的委托变量/绑定Lambda回调
___________________________________________________________________________________________

[TOC]

___________________________________________________________________________________________


### UAttributeMenuWidgetController 中创建动态委托，创建在蓝图中需要配置DataAsset的变量
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/326934_181307.png?raw=true)
### 情况说明：
    _ 每当调用 HUD 的GetAttributeMenuWidgetController函数，就会触发 `BindCallbacksToDependencies()` 事件
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/278143_430450.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/228642_648926.png?raw=true)
    _ 又因为在蓝图函数库 UAuraAbilitySystemLibrary 中的 静态 函数 `GetAttributeMenuWidgetController()` 调用了 HUD 的 `GetAttributeMenuWidgetController()` 函数
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/517127_447490.png?raw=true)
    _ 理论上是每次调用蓝图节点 `GetAttributeMenuWidgetController()` 函数获取 AttributeMenuWidgetController 时，触发 `BindCallbacksToDependencies()` 事件，但是因为 HUD 中只有当变量为nullptr时才会执行一次，所以相当于初始化的绑定
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/383296_73335.png?raw=true)
        _ 只执行一次 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/576325_44483.png?raw=true)
### *BP_AttributeMenuWidgetController* 中配置DataAsset的变量
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/646645_946592.png?raw=true)
_ UAttributeMenuWidgetController 中  广播的函数加UFUNCTION( *BlueprintCallable* )
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/175968_620818.png?raw=true)
### *WBP_AttributeMenu* 中 调用广播 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/240548_4441.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/844862_757798.png?raw=true)
### *WBP_TextValueRow* 中将需要用到的参数：文字/数值 提升为变量 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/512072_632122.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/914795_783143.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/701746_743681.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/15394_693158.png?raw=true)
    _ 将文字提升为变量
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/751114_890677.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/869011_245751.png?raw=true)
### *WBP_TextValueButtonRow* 中绑定委托和回调，使用参数设置UI变量 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/99177_248380.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/611187_668622.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/428212_393550.png?raw=true)
### 测试打印结果 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/770688_518017.png?raw=true)
### *WBP_TextValueRow* 中加入GameplayTag变量 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/625980_555782.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/309005_985314.png?raw=true)
### *WBP_AttributeMenu* 中 给每个属性UI改名 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/243269_462086.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/57686_970456.png?raw=true) 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/47059_479512.png?raw=true) 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/541964_477504.png?raw=true)
    _ 添加调用，修改逻辑 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/121289_670874.png?raw=true)
### *WBP_TextValueButtonRow* 中 检查GameplayTag标签 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/330691_488186.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/370118_67942.png?raw=true)
### 测试打印结果 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/808403_168623.png?raw=true)
### 四种方法！！！现在需要把类型变量与静态函数的函数指针进行绑定(委托绑定/变参函数模板)
    _ 乞丐版： 不绑定直接复制粘贴，修改变量名字，加一堆， 复制粘贴 ，代码质量较低
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/983553_519555.png?raw=true)
        _ 太乞丐，我就不用了
    _ 正常版： 退而求其次， 类型变量与委托绑定
        _ 正常版： 此时因为 UAttributeMenuWidgetController 中逻辑是这么写的，所以如果要绑定需要把所有的属性都搞一遍，太麻烦，此时搞一个 正常版的技术思路 ，使用键值对，保存GameplayTag和委托，这样可以根据Tag，调用对应的事件 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/872726_546078.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/729710_982370.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/598558_918343.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/17924_51324.png?raw=true)
            _ 运行测试 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/736500_717583.png?raw=true)
            _ 思路为 ：使用键值对TMap，保存GameplayTag和委托，这样可以将GameplayTag和委托事件绑定，根据Tag，调用对应的事件
    _ 注意事项！！如果不用委托记得移除！！！！！！！
        _ 如果不用委托记得移除 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/723193_662578.png?raw=true)
    _ 高级但纯纯炫技傻缺版：使用变参函数模板 ————但是可以改良 嘎嘎高级版
        _ 原理
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/15291_471689.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/843447_407103.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/851330_865253.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/742016_220113.png?raw=true)
        _ 构造中传的第一个参数tag不对！！！ 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/147584_325860.png?raw=true)
        _ 上图大意了 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/59462_153524.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/439079_307190.png?raw=true)
        _ 测试结果 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/322550_254376.png?raw=true)
        _ 起别名，弥补傻缺感
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/409675_932424.png?raw=true)
        _ 使用类模板， 嘎嘎高级版
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/870651_229875.png?raw=true)
            _ 使用非常方便 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/342180_238231.png?raw=true)
    _ 高级版：使用函数指针
        _ 原理
            _ 其实之前写了函数指针类型
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/365617_309358.png?raw=true)
            _ 演示 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/488539_157471.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/883443_735016.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/439456_254339.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/652524_603541.png?raw=true)
        _ 测试结果 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/216418_291189.png?raw=true)
### 加入TMap中加入主要属性和次要属性
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/821558_474912.png?raw=true)
### 测试结果 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/637920_698208.png?raw=true)
### UAttributeMenuWidgetController 中，现在需要使用ASC的当属性变化广播绑定委托API，绑定所有属性回调使用lambda
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/450918_874362.png?raw=true)
### UAttributeMenuWidgetController 中，将共有的功能抽象成单独的函数
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/532786_31759.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/115538_822466.png?raw=true)
### 测试用逻辑
    _ 测试用逻辑：记得用完移除！！！ 我把火，ge进入时每秒+1抗性
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/410969_287981.png?raw=true)
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/692185_754402.png?raw=true)
### 测试结果gif 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_023/983835_918802.gif?raw=true)

___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________