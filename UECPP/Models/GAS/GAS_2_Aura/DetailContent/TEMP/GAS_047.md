___________________________________________________________________________________________
###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 047 

___________________________________________________________________________________________

## 处理关键点

1. 111111111111111111111111111111

2. 222222222222222222222222222

3. 33333333333333333333333333

4. 4444444444444444444444444444

5. 555555555555555555555555555555

6. 666666666666666666666666666

7. 77777777777777777777777777777777

___________________________________________________________________________________________

# 目录


[TOC]

___________________________________________________________________________________________

### 欢迎来到你的下一个任务。现在，我们将创建一个敌人生命值条

![image-20240805233026667](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240805233026667.png)

![image-20240805233119051](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240805233119051.png)

1. 
在敌人 持有自身的UI指针

![image-20240805234209315](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240805234209315.png)

构造中创建UI组件`WidgetComponent`并绑定到根组件

![image-20240805234354461](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240805234354461.png)

_________________

在这个路径下创建敌人血条UI

![image-20240805234631333](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240805234631333.png)

继承自`AuraUserWidget`

![image-20240805234715829](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240805234715829.png)

叫 *WBP_ProgressBar*
1. 创建`SizeBox`设置为变量,改名为`SizeBox_Root
2. 在蓝图中创建配置的函数
3. Width和Height分别创建变量 `BoxWidth` `BoxHeight`，创建分组ProgressBarProperties
4. 设置形状`80*6`
5. 合并为函数取名`UpdateBoxSize`

![image-20240805235324368](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240805235324368.png)

1. 创建`Overlay`设置为变量，改名`Overlay_Root`
2. 创建`ProgressBar`设置为变量，改名**`ProgressBar_Front`**并将`Style->BackgroundImage->Tint->Alpha`设置为0（这样就有了透明背景）如果想调节颜色只需要调节`Style->FillImage->Tint`的颜色即可
3. 蓝图中设置**`ProgressBar_Front`**的`Style`把`FillImage`设置为参数取名`FrontBarFillBrush`放入之前的组ProgressBarProperties中
4. 设置`FrontBarFillBrush`默认值为红色(血条颜色)
5. 合并为函数，取名`UpdateFrontFillBrush`

![image-20240806000058363](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806000058363.png)

![image-20240806000510045](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806000510045.png)

_______

### 配置敌人血条的组件

1. 设置敌人血条的组件为屏幕空间显示
2. 配置刚创建的UI *WBP_ProgressBar*
3. 勾选绘制UI的尺寸

![image-20240806000723024](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806000723024.png)

![image-20240806000933616](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806000933616.png)

![image-20240806000915850](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806000915850.png)

此时点击运行，发现敌人的血条有点居中，需要向上加一点偏移

![image-20240806001041504](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806001041504.png)

![image-20240806001058580](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806001058580.png)

![image-20240806001334628](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806001334628.png)

________

但是此时向敌人射击并不会影响到UI

![image-20240806001153558](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806001153558.png)

此时需要为敌人血条UI设置数据

_____________

#### 思考一下:哪个类将拥有代理来广播，以便我们可以将其绑定到我们的进度条上?

> 此前已经在 `OverlayWidgetController` 中创建了动态广播，**可以通过引用该类的头文件，使用该广播**
>
> ![image-20240806001839511](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806001839511.png)

使用该委托，引入 `OverlayWidgetController` 的头文件

![image-20240806002118939](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806002118939.png)

![image-20240806002414923](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806002414923.png)

### 头文件中引入头文件需要注意不要循环引用的问题!

> **所以不需要创建新的委托。我们实际上可以重复使用一个已经存在的委托来实现这个目的**

#### 思考一下:我们什么时候将这些广播到我们的健康条上?

> 思路：
>
> 1. 当属性变化时，变化的值将会被广播，我们可以绑定这些
> 2. 需要在绑定这些前，将`ASC组件`初始化，在敌人类中这发生在重写的 `BeginPlay` 函数中![image-20240806003000990](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806003000990.png)
> 3. 想要在 `BeginPlay` 函数中，初始化完成后，绑定属性变化通知广播![image-20240806003124418](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806003124418.png)
> 4. 需要获取自建的 `UAuraAttributeSet` 对象，所以先获取 `UAuraAttributeSet` 对象(身上有，`Cast` 一下就行)
> 5. 获取委托后想要绑定一个回调函数，此时决定使用 `Lambda表达式` ，这样避免过多的函数(类型需要为： `const FOnAttributeChangeData& Data` )![image-20240806003620844](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806003620844.png)

这里需要代码

```CPP

//先放个临时的图片
```

![先放个临时的](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806003857002.png)

___________________________________________________________________________________________

```CPP
//MaxHealth也需要找这样处理
//先放个临时的图片
```

![image-20240806004018194](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806004018194.png)

处理一下更简洁

![image-20240806004136028](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806004136028.png)

> **所以现在，当健康和最大健康值发生变化时，会被广播**

#### 剩下的就是，将属性变化的多播委托，绑定到我们的进度条UI *WBP_ProgressBar* 上

> 此时需要创建 *WBP_ProgressBar* 的子类，想要创建一个专门处理血条用的子类，**防止逻辑耦合**
>
> 1. 创建子类继承自 *WBP_ProgressBar* ，取名为 *WBP_EnemyHealthBar* (处理敌人血条绑定的类)
> 2. 敌人血条组件更换血条UI引用为子类![image-20240806004810766](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806004810766.png)

### 梳理一下目前的操作

> 1. 在敌人 `AAuraEnemy` 身上绑定了，属性变化通知(动态多播)
> 2. 敌人 `AAuraEnemy` 身上创建了动态多播 `OnHealthChanged` 和 `OnMaxHealthChanged` ，上面属性变化通知时，把结果通过 `OnHealthChanged` 和 `OnMaxHealthChanged` 广播
> 3. 此时**还没有**在 UI 中进行绑定，但是绑定多播委托需要一个 **`WidgetController` **对象
>
> 问题来了：如何获取 **`WidgetController` **对象并把多播 `OnHealthChanged` 和 `OnMaxHealthChanged` 绑定到 UI ?

![](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/ThinkAbout.png?raw=true)

 打算加在这里，在绑定回调并开始广播之前![image-20240806010322012](C:\Users\ROG\AppData\Roaming\Typora\typora-user-images\image-20240806010322012.png)




___________________________________________________________________________________________

[返回最上面](#Go主菜单)

___________________________________________________________________________________________