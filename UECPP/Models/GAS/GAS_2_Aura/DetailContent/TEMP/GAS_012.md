___________________________________________________________________________________________

###### [Go主菜单](../MainMenu.md)
___________________________________________________________________________________________

# GAS 3.2 绑定GE委托,通过收到的的资产标签,广播信息结构体,触发UI中绑定的WidgetController回调,UI中拿到生成MessageUI的信息
___________________________________________________________________________________________
## 处理关键点
1. 使用ASC组件基类中,写好的委托 `OnGameplayEffectAppliedDelegateToSelf`（当应用GE到ASC时触发回调）
2. 一次性道具 配置资产标签`AssetTag`,这样可以在触发回调时通过`FGameplayEffectSpec`类的对象拿到`FGameplayTagContainer`（这个相当于水杯,tag相当于水）
3. 使用`GEngine->AddOnScreenDebugMessage`（相当于`PrintString`）发Message到视口
4. 先创建表格结构体（需要继承`FTableRowBase`！！！）在创建模板类,根据传入的表格查找指定行（`FindRow`,这里行命名实用了tag字符串的格式,便于查找）
5. `UPROPERTY(EditDefaultOnly)`宏//在编辑器中显示并允许编辑这些属性的默认值,但不允许在实例级别进行修改。
6. C++中创建Tag标签:`FGameplayTag::RequestGameplayTag(FName("Message"));`并使用API（父类标签包含子类标签前提下） :子类`Tag.MatchesTag`(父类Tag)检查子类标签中是否包含父类标签,若反过来检查则不生效,请注意！！！
___________________________________________________________________________________________

[TOC]

___________________________________________________________________________________________



### UAbilitySystemComponent中的多播位置

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/947244_743569.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/644032_611869.png?raw=true)
___________________________________________________________________________________________


### UAuraAbilitySystemComponent 中创建 绑定到多播的事件 和 多播回调
#### 头文件

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/819264_39018.png?raw=true)
___________________________________________________________________________________________


#### 源文件

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/843744_803675.png?raw=true)
___________________________________________________________________________________________


### 何时调用 UAuraAbilitySystemComponent 中的 绑定到多播的事件: AbilityActorInfoSet() 呢？
#### AAuraCharacterBase 中创建虚函数 `InitAbilityActorInfo()`

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/318852_361763.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/254323_105902.png?raw=true)
___________________________________________________________________________________________


#### AAuraCharacter 中重写虚函数 `InitAbilityActorInfo()`

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/833787_825036.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/79016_770935.png?raw=true)
___________________________________________________________________________________________


#### AAuraEnemy 中重写虚函数 `InitAbilityActorInfo()`

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/905251_910791.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/946149_841551.png?raw=true)
___________________________________________________________________________________________


### 此时拾取物品 会有通知 

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/650211_988030.png?raw=true)
___________________________________________________________________________________________


### 资产标签
#### UAuraAbilitySystemComponent中,回调时,打印接收到的 Tag

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/989108_702706.png?raw=true)
___________________________________________________________________________________________


#### 给 药水和水晶 加上资产标签

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/110496_156670.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/310161_474769.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/995305_808446.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/584120_537870.png?raw=true)
___________________________________________________________________________________________


#### 测试打印Tag名字

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/185715_161684.png?raw=true)
___________________________________________________________________________________________


#### 资产标签不在 这里显示 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/160865_66875.png?raw=true)
___________________________________________________________________________________________


### 当上面的属性变化时,想 广播发送给WidgetController(因为要根据Tag生成相应的小UI)

#### 在 UAuraAbilitySystemComponent 中创建广播,并在触发GE的回调时,广播收到的 `FGameplayTagContainer` 类型数据

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/379263_96167.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/224020_759775.png?raw=true)
___________________________________________________________________________________________


#### UOverlayWidgetController 中绑定多播,回调使用Lambda表达式

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/680120_355758.png?raw=true)
___________________________________________________________________________________________


##### 若能触发,说明逻辑正常 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/214225_830722.png?raw=true)
___________________________________________________________________________________________


### 创建一个结构体,收到Tag,发送Tag,UI中根据表格中的结构体查找相应信息,读取并调用UI


#### UOverlayWidgetController 中创建结构体

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/386037_488310.png?raw=true)
___________________________________________________________________________________________


#### UI中创建文件夹,存放UI相关的数据

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/247068_418737.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/216674_492412.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/798105_746811.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/334260_372976.png?raw=true)
___________________________________________________________________________________________


#### 项目设置中 添加Tag

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/645309_792656.png?raw=true)
___________________________________________________________________________________________


#### UOverlayWidgetController 中创建智能指针 保存表格

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/728284_190623.png?raw=true)
___________________________________________________________________________________________


#### BP_OverlayWidgetController 中 配置表格

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/459436_32191.png?raw=true)
___________________________________________________________________________________________


#### 配置表格

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/715099_846876.png?raw=true)
___________________________________________________________________________________________


#### 修改GE中的资产标签

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/364497_467285.png?raw=true) 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/358197_287879.png?raw=true) 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/882147_718200.png?raw=true) 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/236974_336495.png?raw=true)
___________________________________________________________________________________________


### UOverlayWidgetController 中创建一个模板函数,根据传入的表格和Tag,找到指定的行结构体并返回

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/682403_4212.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/672234_584217.png?raw=true)
___________________________________________________________________________________________


### 在 UOverlayWidgetController 中创建动态多播,在获取到表格信息时广播到UI

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/619644_606956.png?raw=true)

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/196999_401152.png?raw=true)
___________________________________________________________________________________________


### 小测试:在你觉得最合适的地方绑定多播,并在屏幕上打印 
![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/21331_206961.png?raw=true)
___________________________________________________________________________________________


#### 自己尝试一下

![图片](https://github.com/liyunlong618/LiYunLongKnowledgeLibrary/blob/main/UECPP/Models/GAS/GAS_2_Aura/DetailContent/Image/GAS_012/225036_944810.png?raw=true)

___________________________________________________________________________________________

[返回最上面](#Go主菜单)
___________________________________________________________________________________________